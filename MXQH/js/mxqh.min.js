!function(){function httpWatch($cookieStore){return{request:function(config){return $cookieStore.get("user-token")&&(config.headers["x-session-token"]=$cookieStore.get("user-token")),config.headers["x-function"]=$cookieStore.get("active-function")||"",config}}}angular.module("AjaxServiceModule",["appData","ngAnimate","toastr","ngCookies"]),angular.module("AjaxServiceModule").config(function($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",$httpProvider.defaults.transformRequest=function(data){return void 0===data?data:$.param(data)},$httpProvider.interceptors.push(httpWatch)}),angular.module("AjaxServiceModule").factory("httpWatch",httpWatch)}();
!function(){function AjaxService($rootScope,$http,$q,serviceUrl,appUrl,toastr,MyPop,$cookieStore,$window,FileUrl,SocketServiceUrl,$state){var generic="Common.asmx/Do",tableConfigList=new Array;return{DoBefore:function(method,en){var d=$q.defer(),url=serviceUrl+"Common.asmx/DoBefore",json={method:method,Json:JSON.stringify(en)};return httpFun(d,url,json)},Custom:function(method,en){return Ajax($q.defer(),serviceUrl+generic,en=en||{},method,void 0,"Custom")},BasicCustom:function(method,en){return Ajax($q.defer(),serviceUrl+generic,en=en||{},method)},GetPlan:function(name,json,limitCol){return plan(name,json,"GetPlan",void 0,void 0,limitCol)},GetPlans:GetPlans,GetPlansTop:function(name,json,top,limitCol){return plan(name,json,"GetPlansTop",void 0,void 0,limitCol,top)},GetPlansPage:function(name,json,index,size,limitCol){var s=index<=1?1:(index-1)*size+1;return plan(name,json,"GetPlansPage",s,s+size-1,limitCol)},GetPlanExcel:function(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return Ajax(d,url,en,"GetPlanExcel")},GetPlanOwnExcel:function(name,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,"--",json=json||[]);return Ajax(d,url,en,"GetPlanOwnExcel")},SavePlan:function(name,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,void 0,json);return Ajax(d,url,en,"SavePlan")},ReflashPlan:function(name){var d=$q.defer(),url=serviceUrl+generic,en={};return en.planName=name,Ajax(d,url,en,"ReflashPlan")},DeletePlan:function(name,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,void 0,json);return Ajax(d,url,en,"DeletePlan")},PlanInsert:function(name,json){return planAjax(name,JSON.stringify(json),"Insert")},PlanUpdate:function(name,json){return planAjax(name,JSON.stringify(json),"Update")},PlanDelete:function(name,json){return planAjax(name,JSON.stringify(json),"Delete")},PlanBak:function(action,json){var d=$q.defer(),url=serviceUrl+generic,en={};return en.action=action,en.strJson=json,Ajax(d,url,en,"PlanBak")},ExecPlan:function(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return Ajax(d,url,en,"ExecPlan")},ExecPlanPage:function(name,shortName,json,index,size){var d=$q.defer(),url=serviceUrl+generic,s=index<=1?1:(index-1)*size+1,en=getEn(name,shortName,json);return en.start=s,en.end=s+size,Ajax(d,url,en,"ExecPlanPage")},ExecPlanToExcel:function(name,shortName,json,sheetTable){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return en.sheetTable=JSON.stringify(convertArray(sheetTable)),Ajax(d,url,en,"ExecPlanToExcel")},GetEntity:function(name,json){return entity(name,json,"GetEntity")},GetEntities:function(name,json){return entity(name,json,"GetEntities")},GetJson:function(data){var d=$q.defer(),url=appUrl+"Data/"+data+"?v="+(new Date).toString();return Ajax(d,url,void 0,void 0,"GET")},Action:function(name,json,action){var d=$q.defer(),url=serviceUrl+generic,en={};return en.strTbView=name,en.strJson=JSON.stringify(json),Ajax(d,url,en,action)},HandleFile:function(type){return AjaxHandle("GetFileList",type)},AjaxHandle:AjaxHandle,AddDialog:function(data){return AjaxHandle("AddDialog",data)},GetTableConfig:function(tbName,clName){var d=$q.defer();if(tableConfigList[tbName+"-"+clName]&&0<tableConfigList[tbName+"-"+clName].length)d.resolve(tableConfigList[tbName+"-"+clName]);else{var list=[{name:"TbName",value:tbName},{name:"ClName",value:clName}];GetPlans("TableConfig",list).then(function(data){tableConfigList[tbName+"-"+clName]=data,d.resolve(data)})}return d.promise},AddUser:function(json){var d=$q.defer(),url=serviceUrl+generic,en={};return en.strJson=JSON.stringify(json),Ajax(d,url,en,"AddUser",void 0,"Authorization")},LoginAction:function(method,en){return Ajax($q.defer(),serviceUrl+generic,en=en||{},method,void 0,"Authorization")},FileImport:function(name,shortName,json,file,inData,sheetTable){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return en.filaName=file,en.bt=inData,en.sheetTable=JSON.stringify(convertArray(sheetTable)),Ajax(d,url,en,"FileImport")},ExecPlanUpload:function(name,shortName,json,fileJson,dir){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return en.fileJson=JSON.stringify(fileJson),en.dir=dir,Ajax(d,url,en,"ExecPlanUpload")},ExecPlanMail:function(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return Ajax(d,url,en,"ExecPlanMail")},GetDefaultPrinter:function(hostIp){return SocketSend("GetDefaultPrinter",void 0,void 0,void 0,void 0,hostIp)},GetLocalPrinters:function(hostIp){var d=$q.defer();return SocketSend("GetLocalPrinters",void 0,void 0,void 0,void 0,hostIp).then(function(data){d.resolve(JSON.parse(data))},function(mes){d.reject(mes)}),d.promise},Print:function(templateId,TS,postData,printerName,hostIp){var d=$q.defer();return SocketSend("Print",templateId,TS,postData,printerName,hostIp).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},PrintMulti:function(templateId,TS,postData,printerName,hostIp){var d=$q.defer();return SocketSend("PrintMulti",templateId,TS,postData,printerName,hostIp).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},GetComPortList:function(hostIp){var d=$q.defer();return SocketSend("GetComPortList",void 0,void 0,void 0,void 0,hostIp).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},GetComWeigth:function(com,Do){var d=$q.defer();return SocketSend("GetComWeigth",void 0,void 0,void 0,com,void 0,Do).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},PlayVoice:function(name){$("#autoVoice").attr("src",FileUrl+"/Voice/"+name)},GetServerTime:function(Do){return CallServerSocket("Time",void 0,void 0,Do)},GetServerSocket:function(json,fun,Do){var socket=void 0;return CallServerSocket("Request",JSON.stringify(json),fun,Do,socket)}};function GetPlans(name,json,limitCol){return plan(name,json,"GetPlans",void 0,void 0,limitCol)}function AjaxHandle(method,data){var q=$q.defer();return httpFun(q,appUrl+"Data/Handler/FileData.ashx",{method:method,data:data}),q.promise}function entity(name,json,funName){var d=$q.defer(),url=serviceUrl+generic,en={};return en.strName=name,en.strJson=JSON.stringify(convertArray(json))||"[]",Ajax(d,url,en,funName)}function plan(name,json,funName,start,end,limitCol,top){return planAjax(name,JSON.stringify(convertArray(json))||"[]",funName,start,end,limitCol,top)}function planAjax(name,json,funName,start,end,limitCol,top){var d=$q.defer(),url=serviceUrl+generic,en={};return en.planName=name,en.strJson=json,en.start=start,en.end=end,en.top=top,en.limitUserCol=limitCol,Ajax(d,url,en,funName)}function Ajax(q,url,parameter,Method,type,service){return httpFun(q,url,{method:Method,Json:JSON.stringify(parameter),service:service||""},type)}function httpFun(q,url,postData,type){return $http({method:type||"POST",url:url+"?v="+Math.random(),dataType:"json",data:postData}).then(function(data){q.resolve(data.data)},function(data){if(q.reject(),401==data.status)$cookieStore.remove("user-token"),$window.location.href!=appUrl+"Access.html#!/login"&&($window.location.href=appUrl+"Access.html#!/login");else{console.log(data);var m=data.data?data.data.split("。")[0].replace(/System.Exception:/,""):"错误";toastr.error(m,"服务错误")}}),q.promise}function getEn(name,shortName,json){var en={};return en.planName=name,en.shortName=shortName,en.strJson=JSON.stringify(json),en}function convertArray(en){if(!en)return en;if("function"==typeof Array.isArray?Array.isArray(en):"[object Array]"===Object.prototype.toString.call(en))return en;var enNew=[];return enNew.push(en),enNew}function SocketSend(method,Id,TS,postData,printerName,hostIp,Do){var g=$q.defer();try{var socket=new WebSocket("ws://"+(hostIp||"127.0.0.1")+":2018");socket.onerror=function(evt){if(console.log(evt.currentTarget),3==evt.currentTarget.readyState){var en={};$window.location.href="MxqhPrinter:"+serviceUrl,en.text="打印服务正在启动，重新发送数据？",MyPop.Confirm(en,function(){SocketSend(method,Id,TS,postData,printerName,hostIp)})}},socket.onopen=function(){var en={};en.Method=method,en.TemplateId=Id,en.TS=TS,en.Data=JSON.stringify(postData),en.ServiceUrl=serviceUrl,en.PrinterName=printerName,socket.send(JSON.stringify(en))},socket.onclose=function(e){},socket.onmessage=function(evt){var reData=JSON.parse(evt.data);"Success"==reData.MesType?g.resolve(reData.Data):"Error"==reData.MesType?(toastr.error(reData.Data,"服务错误"),g.reject(reData.Data)):"Update"==reData.MesType&&(toastr.warning("服务器已有新版本的打印插件，请下载更新"),$window.location.href=reData.Data),Do&&Do(reData)}}catch(e){console.log("服务错误"),toastr.error(e,"服务错误")}return g.promise}function CallServerSocket(MsgType,json,fun,Do,socket){var g=$q.defer();try{var en={Header:"MXQHServer"};en.MsgType=MsgType,en.LoginKey=$cookieStore.get("user-token"),en.RouteName=$state.current.name,en.GUID=$cookieStore.get("GUID"),en.FunName=fun,en.Data=json;!function(g,en,socket,Do){(socket=new WebSocket(SocketServiceUrl)).onerror=function(evt){},socket.onopen=function(){socket.send(JSON.stringify(en))},socket.onclose=function(e){},socket.onmessage=function(evt){var data=JSON.parse(evt.data);"Heartbeat"==data.MsgType?data.RouteName==$state.current.name||"Time"==en.MsgType?socket.send(evt.data):console.log(evt.data):("Success"==data.Response?g.resolve(data.Data):"Error"==data.Response&&(toastr.error(data.Data,"服务错误"),g.reject(data.Data)),Do&&Do(data.Data,socket))}}(g,en,socket,Do)}catch(e){toastr.error(e,"服务错误")}return g.promise}}angular.module("AjaxServiceModule").factory("AjaxService",AjaxService),AjaxService.$inject=["$rootScope","$http","$q","serviceUrl","appUrl","toastr","MyPop","$cookieStore","$window","FileUrl","SocketServiceUrl","$state"]}();
"use strict";angular.module("MyDirective",[]),angular.module("MyDirective").directive("ngConfirm",function(){return{restrict:"A",priority:1,terminal:!0,link:function(scope,element,attr){scope.$watchCollection(attr.ngConfirm,function(options){var en=options||{};en.title=en.title||"确认",en.text=en.text||"是否删除此笔资料",en.type=en.type||"warning",en.showCancelButton=void 0===en.showCancelButton||!0,en.confirmButtonText=en.confirmButtonText||"确定！",en.cancelButtonText=en.cancelButtonText||"取消！";var clickAction=attr.ngClick;element.bind("click",function(){swal(en,function(isConfirm){isConfirm&&scope.$eval(clickAction)})})})}}}).directive("dateTimePicker",["$ocLazyLoad",function($ocLazyLoad){return{require:"?ngModel",restrict:"A",scope:{ngModel:"=",option:"="},link:function(scope,element,attr,ngModel){scope.option=scope.option||{formatTime:"H:i",formatDate:"Y.m.d",timepickerScrollbar:!1},$ocLazyLoad.load("datetimepicker").then(function(){$.datetimepicker.setLocale("zh"),element.datetimepicker(scope.option)})}}}]).directive("datePicker",["$ocLazyLoad",function($ocLazyLoad){return{require:"?ngModel",restrict:"A",scope:{ngModel:"=",option:"="},link:function(scope,element,attr,ngModel){scope.option=scope.option||{format:"Y/m/d",formatDate:"Y/m/d",timepicker:!1},$ocLazyLoad.load("datetimepicker").then(function(){$.datetimepicker.setLocale("zh"),element.datetimepicker(scope.option)})}}}]).directive("basicSelect",["AjaxService","appUrl",function(AjaxService,appUrl){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",searchEnabled:"=",clear:"=",selectClass:"@",autoFirst:"@",placeholder:"@",ngRequired:"@",ngName:"@",limit:"@",ngChange:"&"},templateUrl:function(element,attrs){return appUrl+"CustomFun/UISelect/"+attrs.basicSelect+".html?date="+(new Date).toString()},link:function(scope,element,attrs){scope.data=void 0,scope.autoFirst=scope.autoFirst||"false";var list=[],enName=void 0,ListData=[],NowList=[];if(attrs.basicSelect){var en=[{name:"SelectName",value:attrs.basicSelect}];AjaxService.GetPlan("SysUISelect",en).then(function(data){if(data.SelectName==attrs.basicSelect){var holder=(enName=data).Placeholder||"请选择...";if(scope.placeholder=scope.placeholder||holder,data.SerList&&0<data.SerList.length)for(var i=0,len=data.SerList.length;i<len;i++){var en={};en.name=data.SerList[i].ColName,en.value=data.SerList[i].SerValue,en.type=data.SerList[i].SerExp,en.action=data.SerList[i].SerAss,en.level=data.SerList[i].SerLevel,list.push(en)}list2=angular.copy(list),AjaxService.GetPlans(enName.EntityName,list2).then(function(data2){ListData=angular.copy(data2),0<data2.length&&"true"==scope.autoFirst.toLowerCase()&&!scope.ngModel&&(scope.ngModel=null==enName.ReturnColumn||""==enName.ReturnColumn?data2[0]:data2[0][enName.ReturnColumn]),scope.limit=scope.limit||ListData.length,scope.limit=0==scope.limit?1:scope.limit,scope.limit=100<scope.limit?100:scope.limit,function InitSerData(index,total){if(scope.ngModel&&""!=scope.ngModel&&Math.ceil(1*total/scope.limit)>=index){for(var have=!1,count=index*scope.limit,Templist=[],j=count-scope.limit,len=total<=count?total+scope.limit-count:count;j<len;j++)enName.ReturnColumn&&ListData[j][enName.ReturnColumn]==scope.ngModel?have=!0:enName.ReturnColumn||ListData[j]!=scope.ngModel||(have=!0),Templist.push(ListData[j]);have&&(scope.data=Templist,NowList=angular.copy(Templist)),have||InitSerData(index+1,total)}else scope.data=ListData,NowList=angular.copy(ListData)}(1,ListData.length)})}var list2})}scope.refresh=function(ser){if(ser){scope.data=[];for(var j=0,len=(ListData=ListData||[]).length;j<len;j++)(-1!==ListData[j][enName.ShowColumn].toUpperCase().indexOf(ser.toUpperCase())||ListData[j][enName.ShowSmallColumn]&&-1!==ListData[j][enName.ShowSmallColumn].toUpperCase().indexOf(ser.toUpperCase()))&&scope.data.push(ListData[j]);if(0===scope.data.length){scope.data=[];var list2=angular.copy(list);list2.push({name:enName.ShowColumn,value:"%"+ser+"%"}),AjaxService.GetPlansTop(enName.EntityName,list2,30).then(function(data){scope.data=data})}}else ser&&""!=ser||(scope.data=angular.copy(NowList))},scope.ValueChange=function(){setTimeout(function(){scope.ngChange()},1)}}}}]).directive("serData",["AjaxService","appUrl",function(AjaxService,appUrl){return{restrict:"A",scope:{list:"=",serData:"@"},link:function(scope,element,attrs){if(console.log(scope.serData),scope.serData){var en=[{name:"SelectName",value:scope.serData}];AjaxService.GetPlan("SysUISelect",en).then(function(data){if(data.SelectName){var list=[];if(data.SerList&&0<data.SerList.length)for(var i=0,len=data.SerList.length;i<len;i++){var en={};en.name=data.SerList[i].ColName,en.value=data.SerList[i].SerValue,en.type=data.SerList[i].SerExp,en.action=data.SerList[i].SerAss,en.level=data.SerList[i].SerLevel,list.push(en)}AjaxService.GetPlans(data.EntityName,list).then(function(data2){scope.list=data2})}})}}}}]).directive("functionSelect",["AjaxService","appUrl",function(AjaxService,appUrl){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",funType:"@",ngDisabled:"=",clear:"=",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},templateUrl:function(element,attrs){return appUrl+"CustomFun/UISelect/FunSelect.html?date="+(new Date).toString()},link:function(scope,element,attrs){scope.data=void 0;var en={name:"FunType"};en.value=1==scope.funType?1:2,AjaxService.GetPlans("FunSelect",en).then(function(data){scope.data=data})}}}]).directive("funFileSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",fileType:"=",ngDisabled:"=",clear:"=",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'<div class="py-xl-0 pt-xl-0" ng-class="{ \'input-group\' : clear }">    <ui-select ng-model="$parent.ngModel" theme="bootstrap" ng-change="ngChange()" class="{{ selectClass }}" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="请选择...">{{ $select.selected }}</ui-select-match>          <ui-select-choices repeat="item in data | filter: $select.search track by item">             <div ng-bind-html="item | highlight: $select.search"></div>         </ui-select-choices>     </ui-select>    <span class="input-group-btn" ng-if="clear">        <button ng-click="$parent.ngModel= undefined" class="btn btn-default" ng-disabled="ngDisabled">            <span class="glyphicon glyphicon-trash text-danger"></span>         </button>     </span> </div>',link:function(scope,element,attrs){scope.data=void 0,AjaxService.HandleFile(scope.fileType).then(function(data){scope.data=data})}}}]).directive("objectSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",obConnect:"=",obType:"=",ngDisabled:"=",placeholder:"@",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'    <ui-select ng-model="$parent.ngModel" theme="bootstrap" ng-change="ngChange()" class="{{ selectClass }}" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="{{ placeholder }}">{{ $select.selected.Name }}</ui-select-match>          <ui-select-choices class="pl-1" repeat="item in data | filter: $select.search track by item.Name" refresh="refresh($select.search)" refresh-delay="0">             <small><span ng-bind-html="item.DbSchema | highlight: $select.search"></span>.<span ng-bind-html="item.Name | highlight: $select.search"</span></small>         </ui-select-choices>     </ui-select>',link:function(scope,element,attrs){scope.data=void 0,scope.$watch("obConnect",function(newValue,oldValue){if(scope.obConnect){scope.data=void 0;var en={};en.strCon=scope.obConnect,en.strType=scope.obType,en.strSearch="",AjaxService.BasicCustom("GetDbObject",en).then(function(data){scope.data=data.data,scope.ListData=angular.copy(scope.data)})}}),scope.placeholder=scope.placeholder||"请选择...",scope.refresh=function(ser){if(ser){scope.data=[],scope.ListData=scope.ListData||[];for(var j=0,len=scope.ListData.length;j<len;j++)-1===scope.ListData[j].DbSchema.toUpperCase().indexOf(ser.toUpperCase())&&-1===scope.ListData[j].Name.toUpperCase().indexOf(ser.toUpperCase())||scope.data.push(scope.ListData[j]);if(0===scope.data.length){scope.data=void 0;var en={};en.strCon=scope.obConnect,en.strType=scope.obType,en.strSearch=ser,AjaxService.BasicCustom("GetDbObject",en).then(function(data){scope.data=data.data})}}else scope.data=scope.ListData}}}}]).directive("connectSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",clear:"=",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'<div class="py-xl-0 pt-xl-0" ng-class="{ \'input-group\' : clear }">    <ui-select ng-model="$parent.ngModel" theme="bootstrap" ng-change="ngChange()"  class="{{ selectClass }}" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="请选择...">{{ $select.selected }}</ui-select-match>          <ui-select-choices class="pl-1" repeat="item in data | filter: $select.search track by item" refresh-delay="0">             <div ng-bind-html="item | highlight: $select.search"></div>         </ui-select-choices>     </ui-select>    <span class="input-group-btn" ng-if="clear">        <button ng-click="$parent.ngModel= undefined" class="btn btn-default" ng-disabled="ngDisabled">            <span class="glyphicon glyphicon-trash text-danger"></span>         </button>     </span> </div>',link:function(scope,element,attrs){AjaxService.BasicCustom("GetConnectList").then(function(data){scope.data=data,scope.ListData=angular.copy(scope.data),scope.ngModel=scope.ngModel||data[0]})}}}]).directive("configSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",searchEnabled:"=",configOption:"=",placeholder:"@",selectClass:"@",ngRequired:"@",ngName:"@",autoFirst:"@",ngChange:"&"},template:'<ui-select name="{{ ngName }}" ng-change="ngChange()" class="{{ selectClass }}" ng-model="$parent.ngModel" theme="bootstrap" search-enabled="searchEnabled" ng-disabled="ngDisabled" ng-required="ngRequired"> <ui-select-match placeholder="{{ placeholder }}">{{ $select.selected.ClDesc }}</ui-select-match>        <ui-select-choices repeat="item.ClInf as item in data | propsFilter: {ClInf: $select.search, ClDesc: $select.search}">                                <div ng-bind-html="item.ClDesc | highlight: $select.search"></div>  </ui-select-choices></ui-select>',link:function(scope,element,attrs){scope.data=void 0,scope.autoFirst=scope.autoFirst||"false",scope.placeholder=scope.placeholder||"请选择...",scope.configOption&&AjaxService.GetTableConfig(scope.configOption.Table,scope.configOption.Column).then(function(data){0<(scope.data=data).length&&"true"==scope.autoFirst.toLowerCase()&&(scope.ngModel=scope.ngModel||data[0].ClInf)})}}}]).directive("configSelectMulti",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",searchEnabled:"=",configOption:"=",placeholder:"@",selectClass:"@",ngRequired:"@",ngName:"@",autoFirst:"@",ngChange:"&"},template:'<ui-select name="{{ ngName }}" ng-change="ngChange()" class="{{ selectClass }}" ng-model="$parent.ngModel" theme="bootstrap" search-enabled="searchEnabled" ng-disabled="ngDisabled" ng-required="ngRequired" multiple> <ui-select-match placeholder="{{ placeholder }}">{{ $item.ClDesc }}</ui-select-match>        <ui-select-choices repeat="item.ClInf as item in data | propsFilter: {ClInf: $select.search, ClDesc: $select.search}">                                <div ng-bind-html="item.ClDesc | highlight: $select.search"></div>  </ui-select-choices></ui-select>',link:function(scope,element,attrs){scope.data=void 0,scope.autoFirst=scope.autoFirst||"false",scope.placeholder=scope.placeholder||"请选择...",scope.configOption&&AjaxService.GetTableConfig(scope.configOption.Table,scope.configOption.Column).then(function(data){0<(scope.data=data).length&&"true"==scope.autoFirst.toLowerCase()&&(scope.ngModel&&0!=scope.ngModel.length||(scope.ngModel=[],scope.ngModel.push(data[0].ClInf)))})}}}]).directive("entitySelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",obType:"=",ngDisabled:"=",connectName:"=",clear:"=",selectClass:"@",autoFirst:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'<div class="py-xl-0 pt-xl-0" ng-class="{ \'input-group\' : clear }">    <ui-select ng-model="$parent.ngModel" ng-change="ValueChange()" class="{{ selectClass }}" theme="bootstrap" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="请选择...">{{ $select.selected.EntityName }}</ui-select-match>          <ui-select-choices class="pl-1" repeat="item.EntityName as item in data | filter: $select.search track by item.EntityName" refresh="refresh($select.search)" refresh-delay="0">             <div ng-bind-html="item.EntityName | highlight: $select.search"></div>         </ui-select-choices>     </ui-select>    <span class="input-group-btn" ng-if="clear">        <button ng-click="$parent.ngModel= undefined" class="btn btn-default" ng-disabled="ngDisabled">            <span class="glyphicon glyphicon-trash text-danger"></span>         </button>     </span> </div>',link:function(scope,element,attrs){scope.$watch("connectName",function(newValue,oldValue){scope.data=void 0,scope.ngModel=newValue!=oldValue?void 0:scope.ngModel;var en={name:"ConnectName"};en.value=scope.connectName||"",AjaxService.GetPlans("SelectEntity",en).then(function(data){0<(scope.data=data).length&&"true"==scope.autoFirst.toLowerCase()&&(scope.ngModel=scope.ngModel||data[0].EntityName),scope.ListData=angular.copy(scope.data)})}),scope.autoFirst=scope.autoFirst||"false",scope.data=void 0,scope.ValueChange=function(){setTimeout(function(){scope.ngChange()},100)},scope.refresh=function(ser){if(ser){scope.data=[],scope.ListData=scope.ListData||[];for(var j=0,len=scope.ListData.length;j<len;j++)-1!=scope.ListData[j].EntityName.toUpperCase().indexOf(ser.toUpperCase())&&scope.data.push(scope.ListData[j]);if(0==scope.data.length){scope.data=void 0,scope.ngModel=void 0;var en={},list=[];en.name="ConnectName",en.value=scope.connectName,en.type="=",list.push(en);var en2={name:"EntityName"};en2.value="%"+ser+"%",en2.type="like",list.push(en2),AjaxService.GetPlans("SelectEntity",list).then(function(data){scope.data=data})}}else scope.data=scope.ListData}}}}]).directive("importSheetJs",["$q","AjaxService","toastr","FileLoad","ToJsonWorker","Version",function($q,AjaxService,toastr,FileLoad,ToJsonWorker,Version){return{restrict:"A",scope:{isImport:"@",fileType:"@",opts:"=",ngComplete:"&"},templateUrl:"js/directives/ImportSheetJs.html?v="+Version,link:function($scope,elm){$scope.opts=$scope.opts||{},$scope.fileType=$scope.fileType||"*",$scope.isImport=$scope.isImport||"false",$scope.ngModel=$scope.ngModel||"";var op=$scope.opts;op.sheetNum=op.sheetNum||1,$scope.Open=function(e){e.target.parentNode.parentElement.firstElementChild.click()};var fileInput=elm[0].firstElementChild.firstElementChild.firstElementChild;elm[0].lastElementChild;fileInput.onchange=function(changeEvent){if(changeEvent.target.files&&0!=changeEvent.target.files.length){var file=changeEvent.target.files[0],exec=/[.]/.exec(file.name)?/[^.]+$/.exec(file.name.toLowerCase()):"";if("*"!=$scope.fileType&&-1==$scope.fileType.indexOf(exec[0]))return toastr.error("文件格式不对，请上传 "+$scope.fileType+" 文件!"),!1;$scope.$apply(function(){$scope.ngModel=file.name,$scope.Progress=0});var option={};option.file=file,option.onProcent=function(pro){var d=$q.defer();return setTimeout(function(){$scope.$apply(function(){$scope.Progress=pro})},1e3),d.resolve(""),d.promise},option.onComplete=function(data){ToJsonWorker.onmessage=function(evt){$scope.$apply(function(){$scope.opts.data=evt.data,$scope.ngComplete(),$scope.Progress=0})},ToJsonWorker.postMessage({data:data,op:op})},FileLoad.Load(option)}}}}}]).directive("fileUploadMulti",["$window","Version","toastr","FileService",function($window,Version,toastr,FileService){return{restrict:"A",scope:{ngDisabled:"@",fileType:"@",ngName:"@",ngRequired:"@",placeholder:"@",ableDrag:"@",fileData:"=",ngComplete:"&"},templateUrl:"js/directives/UploadFileMuti.html?v="+Version,controller:["$scope",function($scope){var option={};$scope.List=[],$scope.fileData=$scope.fileData||[],option.onComplete=function(data){$scope.ngComplete&&$scope.ngComplete()},option.onCompleteItem=function(item){$scope.fileData.push(angular.copy(item.data)),item.remove()},$scope.fileType&&"*"!=$scope.fileType&&(option.filter=$scope.fileType),$scope.uploader=FileService.upLoad(option)}],link:function($scope,elm){$scope.fileType=$scope.fileType||"*",$scope.opts=$scope.opts||{},$scope.ngDisabled=$scope.ngDisabled||"false";$scope.opts;$scope.Open=function(e){e.target.parentNode.parentElement.parentElement.lastElementChild.click()},$scope.Delete=function(index){$scope.fileData.splice(index,1)},$scope.DownLoad=function(url){$window.open(url)}}}}]).directive("fileUpload",["$window","Version","toastr","FileService",function($window,Version,toastr,FileService){return{restrict:"A",scope:{ngDisabled:"@",fileType:"@",ngName:"@",ngRequired:"@",placeholder:"@",fileData:"=",ngComplete:"&"},templateUrl:"js/directives/UploadFile.html?v="+Version,controller:["$scope",function($scope){var option={};$scope.fileData=$scope.fileData||{},option.onComplete=function(data){$scope.ngComplete&&$scope.ngComplete(),$scope.isUploaded=!0},option.onCompleteItem=function(item){$scope.fileData=item.data,$scope.item=item},$scope.fileType&&"*"!=$scope.fileType&&(option.filter=$scope.fileType),$scope.uploader=FileService.upLoad(option),$scope.uploader.autoUpload=!0}],link:function($scope,elm){$scope.fileType=$scope.fileType||"*",$scope.ngDisabled=$scope.ngDisabled||"false",$scope.Open=function(e){$scope.uploader.clearQueue(),e.target.parentNode.parentElement.parentElement.lastElementChild.click()},$scope.DownLoad=function(url){$window.open(url)},elm[0].firstElementChild.firstElementChild.lastElementChild.onchange=function(changeEvent){if(changeEvent.target.files&&0!=changeEvent.target.files.length){var file=changeEvent.target.files[0].name,exec=/[.]/.exec(file.name)?/[^.]+$/.exec(file.name.toLowerCase()):"";"*"!=$scope.fileType&&-1==$scope.fileType.indexOf(exec[0])||($scope.fileData.OriginalName=file.name,$scope.isUploaded=!1)}}}}}]).directive("ngStep",function(){return{restrict:"A",scope:{opts:"="},template:"<div></div>",link:function($scope,element,attr){$scope.opts=$scope.opts||{},$scope.opts.now=$scope.opts.now||1,$scope.opts.reject=$scope.opts.reject||$scope.opts.now,$scope.opts.size=$scope.opts.size||"small",$scope.opts.color=$scope.opts.color||"green",$scope.opts.steps=$scope.opts.steps||[{title:"发起",content:"步骤1"},{title:"结束",content:"步骤2"}],$(element).loadStep($scope.opts),$(element).setStep($scope.opts.now,$scope.opts.reject)}}}).directive("replaceEnter",function(){return{restrict:"A",priority:1,terminal:!0,link:function($scope,element,attr){element.html(""),$scope.$watchCollection(attr.replaceEnter,function(data){var en=data?data.replace(/\n/g,"<br/>"):"";element.html(en)})}}});
"use strict";angular.module("FileLoad",[]).factory("FileLoad",["$rootScope","$q","AjaxService","$ocLazyLoad",function($rootScope,$q,AjaxService,$ocLazyLoad){var h={Load:function(option){var me=h;me.precetMethod=option.onProcent,me.type=option.type||"binary",me.encode=option.encode||"utf-8",me.onComplete=option.onComplete,me.onSliceData=option.onProgress,me.onProcent=option.onProcent,me.step=1048576,me.loaded=0,me.times=0,me.result="";$q.defer();var file=me.file=option.file,reader=me.reader=new FileReader;me.total=file.size,reader.onloadstart=me.onLoadStart,reader.onprogress=me.onProgress,reader.onabort=me.onAbort,reader.onerror=me.onerror,reader.onload=me.onLoad,reader.onloadend=me.onLoadEnd,me.readBlob(file,me.loaded),me.result=me.result+reader.result},onLoadStart:function(){},onProgress:function(e){var me=h;me.onProcent&&me.onProcent(me.loaded/me.total*100)},onAbort:function(){},onError:function(){},onLoad:function(e){var me=h;me.onSliceData&&me.onSliceData(e.target.result),me.loaded<me.total?(me.result=me.result+e.target.result,me.readBlob(me.loaded),me.loaded+=me.step):(me.loaded=me.total,me.result=me.result+e.target.result,me.onComplete&&me.onComplete(me.result))},onLoadEnd:function(){},readBlob:function(start){var blob,me=h,file=me.file;switch(me.times+=1,blob=file.slice?file.slice(start,start+me.step):file,me.type){case"binary":me.reader.readAsBinaryString(blob);break;case"buffer":me.reader.readAsArrayBuffer(blob);break;case"url":me.reader.readAsDataURL(blob);break;case"text":me.reader.readAsText(blob,me.encode)}},abortHandler:function(){var me=h;me.reader&&me.reader.abort()}};return h}]);
!function(){function FileService(FileUploader,FileServiceUrl,toastr){var file={upLoad:function(option){option=option||{};var me=file;return me.List=[],option.maxFile=option.maxFile||10,uploader=new FileUploader({url:FileServiceUrl+"FileService.asmx/FileUpload"}),uploader.filters.push({name:"maxFilter",fn:function(item,options){return this.queue.length<option.maxFile}}),option.filter&&uploader.filters.push({name:"FileFilter",fn:function(item,options){var exec=/[.]/.exec(item.name)?/[^.]+$/.exec(item.name.toLowerCase()):"";return-1==option.filter.indexOf(exec[0])?(toastr.error("文件格式不对，请上传 "+option.filter+" 文件!"),!1):-1!=option.filter.indexOf(exec[0])}}),uploader.filters.push({name:"asyncFilter",fn:function(item,options,deferred){setTimeout(deferred.resolve,1e3)}}),uploader.onWhenAddingFileFailed=function(item,filter,options){},uploader.onErrorItem=function(fileItem,response,status,headers){console.log(response),toastr.error("文件上传失败")},uploader.onSuccessItem=function(fileItem,response,status,headers){response[0]&&(me.List.push(response[0]),fileItem.data=response[0],option.onCompleteItem&&option.onCompleteItem(fileItem))},uploader.onCompleteItem=function(fileItem,response,status,headers){},uploader.onCompleteAll=function(){option.onComplete&&option.onComplete(me.List)},uploader}};return file}angular.module("FileService",["angularFileUpload"]),angular.module("FileService").factory("FileService",FileService),FileService.$inject=["FileUploader","FileServiceUrl","toastr"]}();
"use strict";angular.module("ui.load",[]).service("uiLoad",["$document","$q","$timeout",function($document,$q,$timeout){var loaded=[],promise=!1,deferred=$q.defer();this.load=function(srcs){srcs=angular.isArray(srcs)?srcs:srcs.split(/\s+/);var self=this;return promise||(promise=deferred.promise),angular.forEach(srcs,function(src){promise=promise.then(function(){return 0<=src.indexOf(".css")?self.loadCSS(src):self.loadScript(src)})}),deferred.resolve(),promise},this.loadScript=function(src){if(loaded[src])return loaded[src].promise;var deferred=$q.defer(),script=$document[0].createElement("script");return script.src=src,script.onload=function(e){$timeout(function(){deferred.resolve(e)})},script.onerror=function(e){$timeout(function(){deferred.reject(e)})},$document[0].body.appendChild(script),(loaded[src]=deferred).promise},this.loadCSS=function(href){if(loaded[href])return loaded[href].promise;var deferred=$q.defer(),style=$document[0].createElement("link");return style.rel="stylesheet",style.type="text/css",style.href=href,style.onload=function(e){$timeout(function(){deferred.resolve(e)})},style.onerror=function(e){$timeout(function(){deferred.reject(e)})},$document[0].head.appendChild(style),(loaded[href]=deferred).promise}}]);
"use strict";angular.module("app",["appData","ngAnimate","toastr","cgBusy","ngMessages","ngCookies","ngResource","ngSanitize","ngTouch","ngStorage","ui.router","FileService","toggle-switch","ui.bootstrap","ui.load","ui.jq","ui.validate","oc.lazyLoad","pascalprecht.translate","AjaxServiceModule","ui.router.requirePolyfill","MyDirective","FileLoad"]);
var app=angular.module("app").config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function($controllerProvider,$compileProvider,$filterProvider,$provide){app.controller=$controllerProvider.register,app.directive=$compileProvider.directive,app.filter=$filterProvider.register,app.factory=$provide.factory,app.service=$provide.service,app.constant=$provide.constant,app.value=$provide.value}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"l10n/",suffix:".js"}),$translateProvider.preferredLanguage("zh"),$translateProvider.preferredLanguage("cn"),$translateProvider.useLocalStorage()}]);
angular.module("app").constant("JQ_CONFIG",{easyPieChart:["Scripts/jquery/charts/easypiechart/jquery.easy-pie-chart.js"],sparkline:["Scripts/jquery/charts/sparkline/jquery.sparkline.min.js"],plot:["Scripts/jquery/charts/flot/jquery.flot.min.js","Scripts/jquery/charts/flot/jquery.flot.resize.js","Scripts/jquery/charts/flot/jquery.flot.tooltip.min.js","Scripts/jquery/charts/flot/jquery.flot.spline.js","Scripts/jquery/charts/flot/jquery.flot.orderBars.js","Scripts/jquery/charts/flot/jquery.flot.pie.min.js"],slimScroll:["Scripts/jquery/slimscroll/jquery.slimscroll.min.js"],sortable:["Scripts/jquery/sortable/jquery.sortable.js"],nestable:["Scripts/jquery/nestable/jquery.nestable.js","Scripts/jquery/nestable/nestable.css"],filestyle:["Scripts/jquery/file/bootstrap-filestyle.min.js"],slider:["Scripts/jquery/slider/bootstrap-slider.js","Scripts/jquery/slider/slider.css"],chosen:["Scripts/jquery/chosen/chosen.jquery.min.js","Scripts/jquery/chosen/chosen.css"],TouchSpin:["Scripts/jquery/spinner/jquery.bootstrap-touchspin.min.js","Scripts/jquery/spinner/jquery.bootstrap-touchspin.css"],wysiwyg:["Scripts/jquery/wysiwyg/bootstrap-wysiwyg.js","Scripts/jquery/wysiwyg/jquery.hotkeys.js"],dataTable:["Scripts/jquery/datatables/jquery.dataTables.min.js","Scripts/jquery/datatables/dataTables.bootstrap.js","Scripts/jquery/datatables/dataTables.bootstrap.css"],vectorMap:["Scripts/jquery/jvectormap/jquery-jvectormap.min.js","Scripts/jquery/jvectormap/jquery-jvectormap-world-mill-en.js","Scripts/jquery/jvectormap/jquery-jvectormap-us-aea-en.js","Scripts/jquery/jvectormap/jquery-jvectormap.css"],footable:["Scripts/jquery/footable/footable.all.min.js","Scripts/jquery/footable/footable.core.css"]}).config(["$ocLazyLoadProvider",function($ocLazyLoadProvider){$ocLazyLoadProvider.config({debug:!1,events:!0,modules:[{name:"uiGrid",files:["Scripts/ui-grid.min.js","Content/ui-grid.min.css"]},{name:"ngGrid",files:["Scripts/modules/ng-grid/ng-grid.min.js","Scripts/modules/ng-grid/ng-grid.min.css","Scripts/modules/ng-grid/theme.css"]},{name:"fileLoad",files:["Scripts/SheetJs/xlsx.full.min.js"]},{name:"datetimepicker",files:["Scripts/jquery/DateTimePicker/jquery.datetimepicker.min.css","Scripts/jquery/DateTimePicker/jquery.datetimepicker.full.min.js"]},{name:"ui.select",files:["Scripts/select.min.js","Content/select.min.css"]},{name:"angularFileUpload",files:["Scripts/modules/angular-file-upload/angular-file-upload.min.js"]},{name:"ui.calendar",files:["Scripts/modules/angular-ui-calendar/calendar.js"]},{name:"ngImgCrop",files:["Scripts/modules/ngImgCrop/ng-img-crop.js","Scripts/modules/ngImgCrop/ng-img-crop.css"]},{name:"angularBootstrapNavTree",files:["Scripts/modules/angular-bootstrap-nav-tree/abn_tree_directive.js","Scripts/modules/angular-bootstrap-nav-tree/abn_tree.css"]},{name:"toaster",files:["Scripts/modules/angularjs-toaster/toaster.js","Scripts/modules/angularjs-toaster/toaster.css"]},{name:"textAngular",files:["Scripts/modules/textAngular/textAngular-sanitize.min.js","Scripts/modules/textAngular/textAngular.min.js"]},{name:"vr.directives.slider",files:["Scripts/modules/angular-slider/angular-slider.min.js","Scripts/modules/angular-slider/angular-slider.css"]},{name:"com.2fdevs.videogular",files:["Scripts/modules/videogular/videogular.min.js"]},{name:"com.2fdevs.videogular.plugins.controls",files:["Scripts/modules/videogular/plugins/controls.min.js"]},{name:"com.2fdevs.videogular.plugins.buffering",files:["Scripts/modules/videogular/plugins/buffering.min.js"]},{name:"com.2fdevs.videogular.plugins.overlayplay",files:["Scripts/modules/videogular/plugins/overlay-play.min.js"]},{name:"com.2fdevs.videogular.plugins.poster",files:["Scripts/modules/videogular/plugins/poster.min.js"]},{name:"com.2fdevs.videogular.plugins.imaads",files:["Scripts/modules/videogular/plugins/ima-ads.min.js"]}]})}]);
"use strict";function Run($rootScope,$state,$stateParams,$cookieStore,$window,$q,AjaxService,router,appUrl,Version){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$cookieStore.put("active-function","Main"),$rootScope.$on("$stateChangeStart",function(e,toState,toParams,fromState,fromParams){$cookieStore.get("user-token")||($window.location.href=appUrl+"Access.html#!/login")}),$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){AjaxService.Custom("LogBrowse")}),AjaxService.LoginAction("GetFunRoute").then(function(data){angular.forEach(data,function(item){var route={};if(item.RouteName&&""!=item.RouteName){if(route.Name=item.RouteName,route.Url=item.RouteUrl,route.Controller=item.Controller,route.ControllerAs=item.ControllerAs,route.TempleteUrl=item.FunHtml+"?v="+Version,route.FunNo=item.FunNo,item.FunLoad){var loadJs=[];angular.forEach(item.FunLoad,function(l){loadJs.push(l.LoadName+"?v="+Version)}),route.LazyLoad=loadJs}router.setDataRouters(route),$cookieStore.get("active-router")==item.RouteName&&$state.go(item.RouteName)}})}),AjaxService.LoginAction("GetLoginEmp").then(function(data){$rootScope.User=data}),AjaxService.GetPlans("Dialog").then(function(data){$rootScope.DialogData=data}),Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var k in/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},String.prototype.Trim=function(c){if(null==c||""==c){for(var rg=/s/,i=(str=this.replace(/^s*/,"")).length;rg.test(str.charAt(--i)););return str.slice(0,i+1)}rg=new RegExp("^"+c+"*");var str=this.replace(rg,"");rg=new RegExp(c);for(i=str.length;rg.test(str.charAt(--i)););return str.slice(0,i+1)},String.prototype.TrimStart=function(c){if(null==c||""==c)return this.replace(/^s*/,"");var rg=new RegExp("^"+c+"*");return this.replace(rg,"")},String.prototype.TrimEnd=function(c){if(null==c||""==c){for(var rg=/s/,i=(str=this).length;rg.test(str.charAt(--i)););return str.slice(0,i+1)}var str=this;for(rg=new RegExp(c),i=str.length;rg.test(str.charAt(--i)););return str.slice(0,i+1)}}function Config($stateProvider,$urlRouterProvider,Version){$urlRouterProvider.otherwise("/app/dashboard-v1"),$stateProvider.state("app",{abstract:!0,url:"/app",controllerAs:"vm",controller:"AppCtrl",templateUrl:"Basic/app.html?v="+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["ui.select","ngGrid"])}]}}).state("apps",{abstract:!0,controllerAs:"vm",controller:"AppCtrl",url:"/apps",templateUrl:"Basic/layout.html?v="+Version}).state("app.dashboard-v1",{url:"/dashboard-v1",templateUrl:"Basic/app_dashboard_v1.html?v="+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["js/controllers/chart.js"])}]}}).state("app.ui",{url:"/ui",template:'<div ui-view class="fade-in-up"></div>'})}angular.module("app").run(Run),Run.$inject=["$rootScope","$state","$stateParams","$cookieStore","$window","$q","AjaxService","router","appUrl","Version"],angular.module("app").config(Config),Config.$inject=["$stateProvider","$urlRouterProvider","Version"];
"use strict";angular.module("app").factory("Dialog",["$rootScope","$ocLazyLoad","$uibModal","$q","AjaxService","Version",function($rootScope,$ocLazyLoad,$uibModal,$q,AjaxService,Version){return{open:open,OpenDialog:function(name,item){return open(name,{ItemData:function(){return item}})}};function open(name,resolve,option){var d=$q.defer(),dialog=$.grep($rootScope.DialogData,function(e){return e.name==name})[0],config=angular.extend({templateUrl:dialog.templateUrl+"?v="+Version,controller:dialog.controller,backdrop:dialog.backdrop||"static",size:dialog.size},option||{});if(dialog.controllerAs&&(config.controllerAs=dialog.controllerAs),dialog.keyboard&&null==config.keyboard&&(config.keyboard="true"==dialog.keyboard),config.resolve=resolve,dialog.LoadFiles){for(var loadList=[],i=0,len=dialog.LoadFiles.length;i<len;i++)loadList.push(dialog.LoadFiles[i].LoadName+"?v="+Version);$ocLazyLoad.load(loadList).then(function(){d.resolve($uibModal.open(config).result)})}return d.promise}}]);
"use strict";angular.module("app").controller("AppCtrl",["$scope","$localStorage","$window","AjaxService","$state","$rootScope","$cookieStore","appUrl","Dialog","FileUrl",function($scope,$localStorage,$window,AjaxService,$state,$rootScope,$cookieStore,appUrl,Dialog,FileUrl){!!navigator.userAgent.match(/MSIE/i)&&angular.element($window.document.body).addClass("ie"),function($window){var ua=$window.navigator.userAgent||$window.navigator.vendor||$window.opera;return/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/.test(ua)}($window)&&angular.element($window.document.body).addClass("smart");var vm=this;function ChangeSys(item){if(item){if(!item.SysList)for(var i=0,len=vm.SysList.length;i<len;i++)vm.SysList[i].SysNo==item.SysNo&&(item=vm.SysList[i]);vm.SelectedSys=item}}vm.FunctionList=[],vm.SysList=[],vm.FunTree=[],vm.Go=function(routeName){routeName&&$state.go(routeName)},vm.ChangPsw=function(){Dialog.OpenDialog("ChangePswDialog",{}).then(function(data){getListRole()}).catch(function(reason){})},vm.LogOff=function(){AjaxService.LoginAction("LoginOff").then(function(data){$cookieStore.remove("user-token"),$window.location.href=appUrl+"Access.html#!/login"})},vm.Reflash=function(){$state.reload($cookieStore.get("active-router"))},vm.ChangeSys=ChangeSys,vm.DownTool=function(path){$window.location.href=FileUrl+"DownLoad/"+path},vm.app={name:"管理平台",version:"1.3.3",color:{primary:"#7266ba",info:"#23b7e5",success:"#27c24c",warning:"#fad733",danger:"#f05050",light:"#e8eff0",dark:"#3a3f51",black:"#1c2b36"},settings:{themeID:1,navbarHeaderColor:"bg-black",navbarCollapseColor:"bg-white-only",asideColor:"bg-black",headerFixed:!0,asideFixed:!1,asideFolded:!1,asideDock:!1,container:!1}},vm.promise=AjaxService.GetPlans("System").then(function(dataSys){AjaxService.LoginAction("GetUserRoot").then(function(data){vm.FunData=data,vm.FunctionList=[],vm.SysList=vm.SysList||[],dataSys=dataSys||[];for(var i=0,len=data.length;i<len;i++){var sysEn={};sysEn.SysNo=data[i].SysNo;for(var h=0,len1=dataSys.length;h<len1;h++)if(sysEn.SysNo==dataSys[h].SysNo){sysEn.SysName=dataSys[h].SysName;break}for(var have=!1,a=0,len3=vm.SysList.length;a<len3;a++)if(sysEn.SysNo==vm.SysList[a].SysNo){have=!0;break}have||vm.SysList.push(sysEn),data[i].FunList=data[i].FunList||[];for(var j=0,len2=data[i].FunList.length;j<len2;j++){var en={};en.RouteName=data[i].FunList[j].RouteName,en.FunName=data[i].FunName+"/"+data[i].FunList[j].FunName,vm.FunctionList.push(en),$cookieStore.get("active-router")==en.RouteName&&(vm.DefaultSys=sysEn)}}!function(){for(var j=0,len1=vm.SysList.length;j<len1;j++){vm.SysList[j].FunTree=[];for(var i=0,len=vm.FunData.length;i<len;i++)vm.SysList[j].SysNo==vm.FunData[i].SysNo&&vm.SysList[j].FunTree.push(vm.FunData[i])}}(),ChangeSys(vm.DefaultSys||vm.SysList[0]),AjaxService.GetPlans("VwUserBro",{name:"UserNo",value:$rootScope.User?$rootScope.User.UserNo:""}).then(function(data){vm.BrowseList=data})})}),AjaxService.GetPlans("DownloadPlugin").then(function(data){vm.DownList=data}),AjaxService.GetServerTime(function(data){$scope.$apply(function(){vm.SysTime=data})}),angular.isDefined($localStorage.settings)?vm.app.settings=$localStorage.settings:$localStorage.settings=vm.app.settings,$scope.$watch("vm.app.settings",function(){vm.app.settings.asideDock&&vm.app.settings.asideFixed&&(vm.app.settings.headerFixed=!0),$localStorage.settings=vm.app.settings},!0)}]);
"use strict";angular.module("app").provider("router",function($stateProvider){var urlCollection;this.$get=function($http,$state){return{setUpRoutes:function(){$http.get(urlCollection).success(function(collection){for(var routeName in collection)$state.get(routeName)||$stateProvider.state(routeName,collection[routeName])})},setDataRouters:function(route){if(!$state.get(route.Name)){var item={};if(item.url=route.Url,item.templateUrl=route.TempleteUrl,route.Controller&&(item.controller=route.Controller),route.ControllerAs&&(item.controllerAs=route.ControllerAs),route.LazyLoad&&0<route.LazyLoad.length)if(1==route.LazyLoad.length){var len=route.LazyLoad.length;item.resolve={deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(route.LazyLoad)}]}}else{len=route.LazyLoad.length;var js=route.LazyLoad[len-1],arr=angular.copy(route.LazyLoad);arr.splice(len-1,1),item.resolve={deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(arr).then(function(){return $ocLazyLoad.load(js)})}]}}item.resolve=angular.extend(item.resolve||{},{Fun:["$cookieStore",function($cookieStore){return $cookieStore.put("active-function",route.FunNo),$cookieStore.put("active-router",route.Name),route.FunNo}]}),$stateProvider.state(route.Name,item)}}}},this.setCollectionUrl=function(url){urlCollection=url}});
angular.module("app").directive("setNgAnimate",["$animate",function($animate){return{link:function($scope,$element,$attrs){$scope.$watch(function(){return $scope.$eval($attrs.setNgAnimate,$scope)},function(valnew,valold){$animate.enabled(!!valnew,$element)})}}}]);
angular.module("app").directive("uiButterbar",["$rootScope","$anchorScroll",function($rootScope,$anchorScroll){return{restrict:"AC",template:'<span class="bar"></span>',link:function(scope,el,attrs){el.addClass("butterbar hide"),scope.$on("$stateChangeStart",function(event){$anchorScroll(),el.removeClass("hide").addClass("active")}),scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState){event.targetScope.$watch("$viewContentLoaded",function(){el.addClass("hide").removeClass("active")})})}}}]);
angular.module("app").directive("uiFocus",function($timeout,$parse){return{link:function(scope,element,attr){var model=$parse(attr.uiFocus);scope.$watch(model,function(value){!0===value&&$timeout(function(){element[0].focus()})}),element.bind("blur",function(){model&&model.assign&&scope.$apply(model.assign(scope,!1))})}}});
angular.module("app").directive("uiFullscreen",["uiLoad","$document","$window",function(uiLoad,$document,$window){return{restrict:"AC",template:'<i class="fa fa-expand fa-fw text"></i><i class="fa fa-compress fa-fw text-active"></i>',link:function(scope,el,attr){el.addClass("hide"),uiLoad.load("Scripts/libs/screenfull.min.js").then(function(){screenfull.enabled&&!navigator.userAgent.match(/Trident.*rv:11\./)&&el.removeClass("hide"),el.on("click",function(){var target;attr.target&&(target=$(attr.target)[0]),screenfull.toggle(target)}),$document.on(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?el.addClass("active"):el.removeClass("active")})})}}}]);
"use strict";angular.module("ui.jq",["ui.load"]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","JQ_CONFIG","uiLoad","$timeout",function(uiJqConfig,JQ_CONFIG,uiLoad,$timeout){return{restrict:"A",compile:function(tElm,tAttrs){if(!angular.isFunction(tElm[tAttrs.uiJq])&&!JQ_CONFIG[tAttrs.uiJq])throw new Error('ui-jq: The "'+tAttrs.uiJq+'" function does not exist');var options=uiJqConfig&&uiJqConfig[tAttrs.uiJq];return function(scope,elm,attrs){function callPlugin(){$timeout(function(){var linkOptions;elm[attrs.uiJq].apply(elm,(linkOptions=[],attrs.uiOptions?(linkOptions=scope.$eval("["+attrs.uiOptions+"]"),angular.isObject(options)&&angular.isObject(linkOptions[0])&&(linkOptions[0]=angular.extend({},options,linkOptions[0]))):options&&(linkOptions=[options]),linkOptions))},0,!1)}function refresh(){attrs.uiRefresh&&scope.$watch(attrs.uiRefresh,function(){callPlugin()})}attrs.ngModel&&elm.is("select,input,textarea")&&elm.bind("change",function(){elm.trigger("input")}),JQ_CONFIG[attrs.uiJq]?uiLoad.load(JQ_CONFIG[attrs.uiJq]).then(function(){callPlugin(),refresh()}).catch(function(){}):(callPlugin(),refresh())}}}}]);
angular.module("app").directive("uiModule",["MODULE_CONFIG","uiLoad","$compile",function(MODULE_CONFIG,uiLoad,$compile){return{restrict:"A",compile:function(el,attrs){var contents=el.contents().clone();return function(scope,el,attrs){el.contents().remove(),uiLoad.load(MODULE_CONFIG[attrs.uiModule]).then(function(){$compile(contents)(scope,function(clonedElement,scope){el.append(clonedElement)})})}}}}]);
angular.module("app").directive("uiNav",["$timeout",function($timeout){return{restrict:"AC",link:function(scope,el,attr){var next,_window=$(window),wrap=$(".app-aside");el.on("click","a",function(e){next&&next.trigger("mouseleave.nav");var _this=$(this);_this.parent().siblings(".active").toggleClass("active"),_this.next().is("ul")&&_this.parent().toggleClass("active")&&e.preventDefault(),_this.next().is("ul")||_window.width()<768&&$(".app-aside").removeClass("show off-screen")}),el.on("mouseenter","a",function(e){if(next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||_window.width()<768||$(".app-aside-dock").length)){var top,_this=$(e.target),w_h=$(window).height();!_this.is("a")&&(_this=_this.closest("a")),_this.next().is("ul")&&(next=_this.next(),_this.parent().addClass("active"),top=_this.parent().position().top+50,next.css("top",top),top+next.height()>w_h&&next.css("bottom",0),w_h<top+150&&next.css("bottom",w_h-top-50).css("top","auto"),next.appendTo(wrap),next.on("mouseleave.nav",function(e){$(".dropdown-backdrop").remove(),next.appendTo(_this.parent()),next.off("mouseleave.nav").css("top","auto").css("bottom","auto"),_this.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(next){next&&next.trigger("mouseleave.nav")}))}}),wrap.on("mouseleave",function(e){next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove()})}}}]);
angular.module("app").directive("uiScroll",["$location","$anchorScroll",function($location,$anchorScroll){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){$location.hash(attr.uiScroll),$anchorScroll()})}}}]);
angular.module("app").directive("uiShift",["$timeout",function($timeout){return{restrict:"A",link:function(scope,el,attr){var parent,_el=$(el),_window=$(window),prev=_el.prev(),width=_window.width();function sm(){$timeout(function(){var method=attr.uiShift,target=attr.target;_el.hasClass("in")||_el[method](target).addClass("in")})}function md(){parent&&parent.prepend(el),!parent&&_el.insertAfter(prev),_el.removeClass("in")}!prev.length&&(parent=_el.parent()),width<768&&sm()||md(),_window.resize(function(){width!==_window.width()&&$timeout(function(){_window.width()<768&&sm()||md(),width=_window.width()})})}}}]);
angular.module("app").directive("uiToggleClass",["$timeout","$document",function($timeout,$document){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){e.preventDefault();var classes=attr.uiToggleClass.split(","),targets=attr.target&&attr.target.split(",")||Array(el),key=0;angular.forEach(classes,function(_class){var target=targets[targets.length&&key];-1!==_class.indexOf("*")&&function(_class,target){var patt=new RegExp("\\s"+_class.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g"),cn=" "+$(target)[0].className+" ";for(;patt.test(cn);)cn=cn.replace(patt," ");$(target)[0].className=$.trim(cn)}(_class,target),$(target).toggleClass(_class),key++}),$(el).toggleClass("active")})}}}]).directive("uiRemoveClass",["$timeout","$document",function($timeout,$document){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){e.preventDefault();var classes=attr.uiRemoveClass.split(","),targets=attr.target&&attr.target.split(",")||Array(el),key=0;angular.forEach(classes,function(_class){var target=targets[targets.length&&key];-1!==_class.indexOf("*")&&function(_class,target){var patt=new RegExp("\\s"+_class.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g"),cn=" "+$(target)[0].className+" ";for(;patt.test(cn);)cn=cn.replace(patt," ");$(target)[0].className=$.trim(cn)}(_class,target),$(target).removeClass(_class),key++}),$(el).removeClass("active")})}}}]);
"use strict";angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(scope,elm,attrs,ctrl){var validateFn,watch,validators={},validateExpr=scope.$eval(attrs.uiValidate);validateExpr&&(angular.isString(validateExpr)&&(validateExpr={validator:validateExpr}),angular.forEach(validateExpr,function(exprssn,key){validateFn=function(valueToValidate){var expression=scope.$eval(exprssn,{$value:valueToValidate});return angular.isObject(expression)&&angular.isFunction(expression.then)?expression.then(function(){ctrl.$setValidity(key,!0)},function(){ctrl.$setValidity(key,!1)}):expression?ctrl.$setValidity(key,!0):ctrl.$setValidity(key,!1),valueToValidate},validators[key]=validateFn,ctrl.$formatters.push(validateFn),ctrl.$parsers.push(validateFn)}),attrs.uiValidateWatch&&(watch=scope.$eval(attrs.uiValidateWatch),angular.isString(watch)?scope.$watch(watch,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})}):angular.isArray(watch)?angular.forEach(watch,function(expression){scope.$watch(expression,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})})}):angular.isObject(watch)&&angular.forEach(watch,function(expression,validatorKey){angular.isString(expression)&&scope.$watch(expression,function(){validators[validatorKey](ctrl.$modelValue)}),angular.isArray(expression)&&angular.forEach(expression,function(intExpression){scope.$watch(intExpression,function(){validators[validatorKey](ctrl.$modelValue)})})})))}}});
"use strict";angular.module("app").filter("propsFilter",function(){return function(items,props){var out=[];if(angular.isArray(items)){var keys=Object.keys(props);items.forEach(function(item){for(var itemMatches=!1,i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)})}else out=items;return out}});
"use strict";angular.module("app").filter("fromNow",function(){return function(date){return moment(date).fromNow()}});