// config
// lazyload config
(function(){angular.module("AjaxServiceModule",["appData","ngAnimate","toastr","ngCookies"]);angular.module("AjaxServiceModule").config(appConfig);angular.module("AjaxServiceModule").factory("httpWatch",httpWatch);function httpWatch($cookieStore){var obj={"request":function(config){if($cookieStore.get("user-token"))config.headers["x-session-token"]=$cookieStore.get("user-token");config.headers["x-function"]=$cookieStore.get("active-function")||"";return config}};return obj}function appConfig($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset\x3dutf-8";$httpProvider.defaults.transformRequest=function(data){if(typeof data=="undefined")return data;return $.param(data)};$httpProvider.interceptors.push(httpWatch)}})();(function(){angular.module("AjaxServiceModule").factory("AjaxService",AjaxService);AjaxService.$inject=["$rootScope","$http","$q","serviceUrl","appUrl","toastr","$cookieStore","$window"];function AjaxService($rootScope,$http,$q,serviceUrl,appUrl,toastr,$cookieStore,$window){var generic="Common.asmx/Do";var tableConfigList=[];var obj={DoBefore:DoBefore,Custom:Custom,GetPlan:GetPlan,GetPlans:GetPlans,GetPlansPage:GetPlansPage,GetPlanExcel:GetPlanExcel,SavePlan:SavePlan,ReflashPlan:ReflashPlan,DeletePlan:DeletePlan,PlanInsert:PlanInsert,PlanUpdate:PlanUpdate,PlanDelete:PlanDelete,PlanBak:PlanBak,ExecPlan:ExecPlan,ExecPlanToExcel:ExecPlanToExcel,GetEntity:GetEntity,GetEntities:GetEntities,GetJson:GetJson,Action:Action,HandleFile:HandleFile,AddDialog:AddDialog,GetConnect:GetConnect,GetDbObject:GetDbObject,GetColumns:GetColumns,GetTbColumns:GetTbColumns,GetProcColumns:GetProcColumns,GetTableConfig:GetTableConfig,AddUser:AddUser,LoginAction:LoginAction,FileImport:FileImport,ExecPlanUpload:ExecPlanUpload,ExecPlanMail:ExecPlanMail};return obj;function GetJson(data){var d=$q.defer(),url=appUrl+"Data/"+data+"?v\x3d"+(new Date).toString();return Ajax(d,url,undefined,undefined,"GET")}function GetPlan(name,json,limitCol){return plan(name,json,"GetPlan",undefined,undefined,limitCol)}function GetPlans(name,json,limitCol){return plan(name,json,"GetPlans",undefined,undefined,limitCol)}function GetPlansPage(name,json,index,size,limitCol){var s=index<=1?1:(index-1)*size+1;return plan(name,json,"GetPlansPage",s,s+size,limitCol)}function PlanInsert(name,json){return planAjax(name,JSON.stringify(json),"Insert")}function PlanUpdate(name,json){return planAjax(name,JSON.stringify(json),"Update")}function PlanDelete(name,json){return planAjax(name,JSON.stringify(json),"Delete")}function PlanBak(action,json){var d=$q.defer(),url=serviceUrl+generic;var en={};en.action=action;en.strJson=json;return Ajax(d,url,en,"PlanBak")}function GetEntity(name,json){return entity(name,json,"GetEntity")}function GetEntities(name,json){return entity(name,json,"GetEntities")}function Action(name,json,action){var d=$q.defer(),url=serviceUrl+generic;var en={};en.strTbView=name;en.strJson=JSON.stringify(json);return Ajax(d,url,en,action)}function HandleFile(type){var d=$q.defer();return AjaxHandle(d,"GetFileList",type)}function AddDialog(data){var d=$q.defer();return AjaxHandle(d,"AddDialog",data)}function AjaxHandle(q,method,data){var en={"method":method,"data":data};httpFun(q,appUrl+"Data/Handler/FileData.ashx",en);return q.promise}function GetConnect(){var d=$q.defer(),url=serviceUrl+generic;return Ajax(d,url,{},"GetConnectList")}function GetDbObject(con,type,ser){var d=$q.defer(),url=serviceUrl+generic;var en={};en.strCon=con;en.strType=type;en.strSearch=ser;return Ajax(d,url,en,"GetDbObject")}function GetColumns(con){var d=$q.defer(),g=$q.defer(),url=serviceUrl+generic;var en={};en.planName=con;Ajax(d,url,en,"GetTbViewColumns").then(function(data){g.resolve(data.data)},function(){g.reject()});return g.promise}function GetProcColumns(conn,proc){var d=$q.defer(),url=serviceUrl+generic;var en={};en.connName=conn;en.strProc=proc;return Ajax(d,url,en,"GetProcColumns")}function GetTbColumns(schema,table,con){var d=$q.defer(),g=$q.defer(),url=serviceUrl+generic;var en={};en.Schema=schema;en.TableName=table;en.ConnectName=con;Ajax(d,url,en,"GetTbColumns").then(function(data){g.resolve(data.data)},function(){g.reject()});return g.promise}function entity(name,json,funName){var d=$q.defer(),url=serviceUrl+generic;var en={};en.strName=name;en.strJson=JSON.stringify(convertArray(json))||"[]";return Ajax(d,url,en,funName)}function plan(name,json,funName,start,end,limitCol){var enJson=JSON.stringify(convertArray(json))||"[]";return planAjax(name,enJson,funName,start,end,limitCol)}function planAjax(name,json,funName,start,end,limitCol){var d=$q.defer(),url=serviceUrl+generic;var en={};en.planName=name;en.strJson=json;en.start=start;en.end=end;en.limitUserCol=limitCol;return Ajax(d,url,en,funName)}function SavePlan(name,json){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,undefined,json);return Ajax(d,url,en,"SavePlan")}function ReflashPlan(name){var d=$q.defer(),url=serviceUrl+generic;var en={};en.planName=name;return Ajax(d,url,en,"ReflashPlan")}function DeletePlan(name,json){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,undefined,json);return Ajax(d,url,en,"DeletePlan")}function ExecPlan(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,shortName,json);return Ajax(d,url,en,"ExecPlan")}function ExecPlanMail(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,shortName,json);return Ajax(d,url,en,"ExecPlanMail")}function ExecPlanUpload(name,shortName,json,fileJson,dir){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,shortName,json);en.fileJson=JSON.stringify(fileJson);en.dir=dir;return Ajax(d,url,en,"ExecPlanUpload")}function ExecPlanToExcel(name,shortName,json,sheetTable){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,shortName,json);en.sheetTable=JSON.stringify(convertArray(sheetTable));return Ajax(d,url,en,"ExecPlanToExcel")}function GetPlanExcel(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,shortName,json);return Ajax(d,url,en,"GetPlanExcel")}function AddUser(json){var d=$q.defer(),url=serviceUrl+generic;var en={};en.strJson=JSON.stringify(json);return Ajax(d,url,en,"AddUser",undefined,"Authorization")}function DoBefore(method,en){var d=$q.defer(),url=serviceUrl+"Common.asmx/DoBefore";var json={method:method,Json:JSON.stringify(en)};return httpFun(d,url,json)}function LoginAction(method,en){var d=$q.defer(),url=serviceUrl+generic;en=en||{};return Ajax(d,url,en,method,undefined,"Authorization")}function Custom(method,en){var d=$q.defer(),url=serviceUrl+generic;en=en||{};return Ajax(d,url,en,method,undefined,"Custom")}function GetTableConfig(tbName,clName){var d=$q.defer(),listHave=[];for(var j=0,len=tableConfigList.length;j<len;j++)if(tableConfigList[j].TbName==tbName&&tableConfigList[j].ClName==clName)listHave.push(tableConfigList[j]);if(listHave.length>0)d.resolve(listHave);else{var list=[{name:"TbName",value:tbName},{name:"ClName",value:clName}];GetPlans("TableConfig",list).then(function(data){for(var j=0,len=data.length;j<len;j++){var have=false;for(var h=0,len=tableConfigList.length;h<len;h++)if(tableConfigList[h].TbName==data[j].TbName&&tableConfigList[h].ClName==data[j].ClName&&tableConfigList[h].ClInf==data[j].ClInf)have=true;if(have)tableConfigList.push(data[j])}d.resolve(data)})}return d.promise}function FileImport(name,shortName,json,file,inData,sheetTable){var d=$q.defer(),url=serviceUrl+generic;var en=getEn(name,shortName,json);en.filaName=file;en.bt=inData;en.sheetTable=JSON.stringify(convertArray(sheetTable));return Ajax(d,url,en,"FileImport")}function Ajax(q,url,parameter,Method,type,service){var en={method:Method,Json:JSON.stringify(parameter),service:service||""};return httpFun(q,url,en,type)}function TbAjax(q,url,parameter,Method,type,service){var en={method:Method,Json:JSON.stringify(parameter),service:service||""};return httpTbFun(q,url,en,type)}function httpTbFun(q,url,postData,type){var g=$q.defer();httpFun(g,url,postData,type).then(function(data){q.resolve(data.data)},function(){q.reject()});return q.promise}function httpFun(q,url,postData,type){$http({method:type||"POST",url:url,dataType:"json",data:postData}).then(function(data){q.resolve(data.data)},function(data){q.reject();if(data.status==401){$cookieStore.remove("user-token");if($window.location.href!=appUrl+"Acess.html#!/login")$window.location.href=appUrl+"Acess.html#!/login"}else{console.log(data);var m=data.data?data.data.split("\u3002")[0].replace(/System.Exception:/,""):"\u9519\u8bef";toastr.error(m,"\u670d\u52a1\u9519\u8bef")}});return q.promise}function getEn(name,shortName,json){var en={};en.planName=name;en.shortName=shortName;en.strJson=JSON.stringify(json);return en}function convertArray(en){if(!en)return en;var isArr;if(typeof Array.isArray==="function")isArr=Array.isArray(en);else isArr=Object.prototype.toString.call(en)==="[object Array]";if(isArr)return en;else{var enNew=[];enNew.push(en);return enNew}}}})();"use strict";angular.module("MyDirective",[]);angular.module("MyDirective").directive("ngConfirm",function(){return{restrict:"A",priority:1,terminal:true,link:link};function link(scope,element,attr){scope.$watchCollection(attr.ngConfirm,function(options){var en=options||{};en.title=en.title||"\u786e\u8ba4";en.text=en.text||"\u662f\u5426\u5220\u9664\u6b64\u7b14\u8d44\u6599";en.type=en.type||"warning";en.showCancelButton=en.showCancelButton===undefined||true;en.confirmButtonText=en.confirmButtonText||"\u786e\u5b9a\uff01";en.cancelButtonText=en.cancelButtonText||"\u53d6\u6d88\uff01";var clickAction=attr.ngClick;element.bind("click",function(){swal(en,function(isConfirm){if(isConfirm)scope.$eval(clickAction)})})})}}).directive("dateTimePicker",["$ocLazyLoad",function($ocLazyLoad){return{require:"?ngModel",restrict:"A",scope:{ngModel:"\x3d",option:"\x3d"},link:function(scope,element,attr,ngModel){scope.option=scope.option||{formatTime:"H:i",formatDate:"Y.m.d",timepickerScrollbar:false};$ocLazyLoad.load("datetimepicker").then(function(){$.datetimepicker.setLocale("zh");element.datetimepicker(scope.option)})}}}]).directive("companySelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",Clear:"\x3d",ngDisabled:"\x3d",searchEnabled:"\x3d",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'\x3cdiv class\x3d"py-xl-0 pt-xl-0" ng-class\x3d"{ \'input-group\' : clear }"\x3e'+'\x3cui-select name\x3d"{{ ngName }}" ng-model\x3d"$parent.ngModel"  class\x3d"{{ selectClass }}" theme\x3d"bootstrap" search-enabled\x3d"searchEnabled" ng-disabled\x3d"ngDisabled" ng-required\x3d"myRequired"\x3e'+'  \x3cui-select-match placeholder\x3d"\u9009\u62e9\u7ec4\u7ec7..."\x3e{{ $select.selected.CompanyName }}\x3c/ui-select-match\x3e       '+' \x3cui-select-choices repeat\x3d"item.CompanyNo as item in data | filter: $select.search track by item.CompanyNo"\x3e                          '+'      \x3cdiv ng-bind-html\x3d"item.CompanyNo | highlight: $select.search"\x3e\x3c/div\x3e                             '+'      \x3csmall ng-bind-html\x3d"item.CompanyName | highlight: $select.search"\x3e\x3c/small\x3e                       '+"  \x3c/ui-select-choices\x3e                                                                                  "+"\x3c/ui-select\x3e"+'    \x3cspan class\x3d"input-group-btn" ng-if\x3d"clear"\x3e'+'        \x3cbutton ng-click\x3d"$parent.ngModel\x3d undefined" class\x3d"btn btn-default" ng-disabled\x3d"ngDisabled"\x3e'+'            \x3cspan class\x3d"glyphicon glyphicon-trash text-danger"\x3e\x3c/span\x3e'+"         \x3c/button\x3e"+"     \x3c/span\x3e"+"\x3c/div\x3e",link:link,compile:function(tELe,tAttrs,transcludeFn){return{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){}}}};function link(scope,element,attrs){scope.data=undefined;AjaxService.GetEntities("Company").then(function(data){scope.data=data;$.grep(data,function(e){if(e.CompanyNo===scope.ngModel){scope.selectItem=e;return}})})}}]).directive("systemSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",ngDisabled:"\x3d",searchEnabled:"\x3d",clear:"\x3d",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'\x3cdiv class\x3d"py-xl-0 pt-xl-0" ng-class\x3d"{ \'input-group\' : clear }"\x3e'+'\x3cui-select  ng-model\x3d"$parent.ngModel" theme\x3d"bootstrap"  class\x3d"{{ selectClass }}" search-enabled\x3d"searchEnabled" ng-disabled\x3d"ngDisabled" name\x3d"{{ ngName }}" ng-required\x3d"myRequired"\x3e'+' \x3cui-select-match placeholder\x3d"\u9009\u62e9\u7cfb\u7edf..."\x3e{{ $select.selected.SysName }}\x3c/ui-select-match\x3e       '+' \x3cui-select-choices repeat\x3d"item.SysNo as item in data | filter: $select.search track by item.SysNo"\x3e             '+'      \x3cdiv ng-bind-html\x3d"item.SysNo | highlight: $select.search"\x3e\x3c/div\x3e                             '+'      \x3csmall ng-bind-html\x3d"item.SysName | highlight: $select.search"\x3e\x3c/small\x3e                       '+"  \x3c/ui-select-choices\x3e                                                                                  "+"\x3c/ui-select\x3e"+'    \x3cspan class\x3d"input-group-btn" ng-if\x3d"clear"\x3e'+'        \x3cbutton ng-click\x3d"$parent.ngModel\x3d undefined" class\x3d"btn btn-default" ng-disabled\x3d"ngDisabled"\x3e'+'            \x3cspan class\x3d"glyphicon glyphicon-trash text-danger"\x3e\x3c/span\x3e'+"         \x3c/button\x3e"+"     \x3c/span\x3e"+" \x3c/div\x3e",link:link};function link(scope,element,attrs){scope.data=undefined;AjaxService.GetEntities("SystemList").then(function(data){scope.data=data})}}]).directive("functionSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",funType:"@",ngDisabled:"\x3d",clear:"\x3d",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'\x3cdiv class\x3d"py-xl-0 pt-xl-0" ng-class\x3d"{ \'input-group\' : clear }"\x3e'+'\x3cui-select ng-model\x3d"$parent.ngModel" ng-change\x3d"ngChange()" theme\x3d"bootstrap" class\x3d"{{ selectClass }}" ng-disabled\x3d"ngDisabled" name\x3d"{{ ngName }}" ng-required\x3d"myRequired"\x3e'+'  \x3cui-select-match placeholder\x3d"\u8bf7\u9009\u62e9..."\x3e{{ $select.selected.FunName }}\x3c/ui-select-match\x3e'+' \x3cui-select-choices repeat\x3d"item.FunNo as item in data | filter: $select.search track by item.FunNo"\x3e'+'      \x3cdiv ng-bind-html\x3d"item.FunNo | highlight: $select.search"\x3e\x3c/div\x3e'+'      \x3csmall ng-bind-html\x3d"item.FunName | highlight: $select.search"\x3e\x3c/small\x3e'+"  \x3c/ui-select-choices\x3e"+"\x3c/ui-select\x3e"+'    \x3cspan class\x3d"input-group-btn" ng-if\x3d"clear"\x3e'+'        \x3cbutton ng-click\x3d"$parent.ngModel\x3d undefined" class\x3d"btn btn-default" ng-disabled\x3d"ngDisabled"\x3e'+'            \x3cspan class\x3d"glyphicon glyphicon-trash text-danger"\x3e\x3c/span\x3e'+"         \x3c/button\x3e"+"     \x3c/span\x3e"+" \x3c/div\x3e",link:link};function link(scope,element,attrs){scope.data=undefined;var en={};en.name="FunType";en.value=scope.funType==1?1:2;AjaxService.GetEntities("Function",en).then(function(data){scope.data=data})}}]).directive("userSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",ngDisabled:"\x3d",clear:"\x3d",selectClass:"@",myRequired:"@",placeholder:"@",ngName:"@",ngChange:"\x26"},template:'\x3cdiv class\x3d"py-xl-0 pt-xl-0" ng-class\x3d"{ \'input-group\' : clear }"\x3e'+'\x3cui-select ng-model\x3d"$parent.ngModel" theme\x3d"bootstrap" ng-change\x3d"ngChange()" class\x3d"{{ selectClass }}" ng-disabled\x3d"ngDisabled" name\x3d"{{ ngName }}" ng-required\x3d"myRequired"\x3e'+'  \x3cui-select-match placeholder\x3d"{{ placeholder }}"\x3e{{ $select.selected.ChiLastName }}{{ $select.selected.ChiFirstName }}\x3c/ui-select-match\x3e'+' \x3cui-select-choices repeat\x3d"item.UserNo as item in data | filter: $select.search track by item.UserNo"\x3e'+'      \x3cdiv ng-bind-html\x3d"item.UserNo | highlight: $select.search"\x3e\x3c/div\x3e'+'      \x3csmall\x3e\x3cspan ng-bind-html\x3d"item.ChiLastName | highlight: $select.search"\x3e\x3c/span\x3e\x3cspan ng-bind-html\x3d"item.ChiFirstName | highlight: $select.search"\x3e\x3c/span\x3e\x3c/small\x3e'+"  \x3c/ui-select-choices\x3e"+"\x3c/ui-select\x3e"+'    \x3cspan class\x3d"input-group-btn" ng-if\x3d"clear"\x3e'+'        \x3cbutton ng-click\x3d"$parent.ngModel\x3d undefined" class\x3d"btn btn-default" ng-disabled\x3d"ngDisabled"\x3e'+'            \x3cspan class\x3d"glyphicon glyphicon-trash text-danger"\x3e\x3c/span\x3e'+"         \x3c/button\x3e"+"     \x3c/span\x3e"+" \x3c/div\x3e",link:link};function link($scope,element,attrs){$scope.data=undefined;$scope.placeholder=$scope.placeholder||"\u8bf7\u9009\u62e9...";AjaxService.GetPlans("User").then(function(data){$scope.data=data})}}]).directive("funFileSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",fileType:"\x3d",ngDisabled:"\x3d",clear:"\x3d",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'\x3cdiv class\x3d"py-xl-0 pt-xl-0" ng-class\x3d"{ \'input-group\' : clear }"\x3e'+'    \x3cui-select ng-model\x3d"$parent.ngModel" theme\x3d"bootstrap" ng-change\x3d"ngChange()" class\x3d"{{ selectClass }}" ng-disabled\x3d"ngDisabled" name\x3d"{{ ngName }}" ng-required\x3d"myRequired"\x3e'+'         \x3cui-select-match placeholder\x3d"\u8bf7\u9009\u62e9..."\x3e{{ $select.selected }}\x3c/ui-select-match\x3e'+'          \x3cui-select-choices repeat\x3d"item in data | filter: $select.search track by item"\x3e'+'             \x3cdiv ng-bind-html\x3d"item | highlight: $select.search"\x3e\x3c/div\x3e'+"         \x3c/ui-select-choices\x3e"+"     \x3c/ui-select\x3e"+'    \x3cspan class\x3d"input-group-btn" ng-if\x3d"clear"\x3e'+'        \x3cbutton ng-click\x3d"$parent.ngModel\x3d undefined" class\x3d"btn btn-default" ng-disabled\x3d"ngDisabled"\x3e'+'            \x3cspan class\x3d"glyphicon glyphicon-trash text-danger"\x3e\x3c/span\x3e'+"         \x3c/button\x3e"+"     \x3c/span\x3e"+" \x3c/div\x3e",link:link};function link(scope,element,attrs){scope.data=undefined;AjaxService.HandleFile(scope.fileType).then(function(data){scope.data=data})}}]).directive("objectSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",obConnect:"\x3d",obType:"\x3d",ngDisabled:"\x3d",placeholder:"@",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'    \x3cui-select ng-model\x3d"$parent.ngModel" theme\x3d"bootstrap" ng-change\x3d"ngChange()" class\x3d"{{ selectClass }}" ng-disabled\x3d"ngDisabled" name\x3d"{{ ngName }}" ng-required\x3d"myRequired"\x3e'+'         \x3cui-select-match placeholder\x3d"{{ placeholder }}"\x3e{{ $select.selected.Name }}\x3c/ui-select-match\x3e'+'          \x3cui-select-choices class\x3d"pl-1" repeat\x3d"item in data | filter: $select.search track by item.Name" refresh\x3d"refresh($select.search)" refresh-delay\x3d"0"\x3e'+'             \x3csmall\x3e\x3cspan ng-bind-html\x3d"item.DbSchema | highlight: $select.search"\x3e\x3c/span\x3e.\x3cspan ng-bind-html\x3d"item.Name | highlight: $select.search"\x3c/span\x3e\x3c/small\x3e'+"         \x3c/ui-select-choices\x3e"+"     \x3c/ui-select\x3e",link:link};function link(scope,element,attrs){scope.data=undefined;scope.$watch("obConnect",getData);scope.placeholder=scope.placeholder||"\u8bf7\u9009\u62e9...";function getData(newValue,oldValue){if(scope.obConnect){scope.data=undefined;AjaxService.GetDbObject(scope.obConnect,scope.obType,"").then(function(data){scope.data=data.data;scope.ListData=angular.copy(scope.data)})}}scope.refresh=function refresh(ser){if(ser){scope.data=[];scope.ListData=scope.ListData||[];for(var j=0,len=scope.ListData.length;j<len;j++)if(scope.ListData[j].DbSchema.toUpperCase().indexOf(ser.toUpperCase())!==-1||scope.ListData[j].Name.toUpperCase().indexOf(ser.toUpperCase())!==-1)scope.data.push(scope.ListData[j]);if(scope.data.length===0){scope.data=undefined;AjaxService.GetDbObject(scope.obConnect,scope.obType,ser).then(function(data){scope.data=data.data})}}else scope.data=scope.ListData}}}]).directive("connectSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",ngDisabled:"\x3d",clear:"\x3d",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'\x3cdiv class\x3d"py-xl-0 pt-xl-0" ng-class\x3d"{ \'input-group\' : clear }"\x3e'+'    \x3cui-select ng-model\x3d"$parent.ngModel" theme\x3d"bootstrap" ng-change\x3d"ngChange()"  class\x3d"{{ selectClass }}" ng-disabled\x3d"ngDisabled" name\x3d"{{ ngName }}" ng-required\x3d"myRequired"\x3e'+'         \x3cui-select-match placeholder\x3d"\u8bf7\u9009\u62e9..."\x3e{{ $select.selected }}\x3c/ui-select-match\x3e'+'          \x3cui-select-choices class\x3d"pl-1" repeat\x3d"item in data | filter: $select.search track by item" refresh-delay\x3d"0"\x3e'+'             \x3cdiv ng-bind-html\x3d"item | highlight: $select.search"\x3e\x3c/div\x3e'+"         \x3c/ui-select-choices\x3e"+"     \x3c/ui-select\x3e"+'    \x3cspan class\x3d"input-group-btn" ng-if\x3d"clear"\x3e'+'        \x3cbutton ng-click\x3d"$parent.ngModel\x3d undefined" class\x3d"btn btn-default" ng-disabled\x3d"ngDisabled"\x3e'+'            \x3cspan class\x3d"glyphicon glyphicon-trash text-danger"\x3e\x3c/span\x3e'+"         \x3c/button\x3e"+"     \x3c/span\x3e"+" \x3c/div\x3e",link:link};function link(scope,element,attrs){AjaxService.GetConnect().then(function(data){scope.data=data;scope.ListData=angular.copy(scope.data);scope.ngModel=scope.ngModel||data[0]})}}]).directive("configSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",ngDisabled:"\x3d",searchEnabled:"\x3d",configOption:"\x3d",placeholder:"@",selectClass:"@",myRequired:"@",ngName:"@",autoFirst:"@",ngChange:"\x26"},template:'\x3cui-select name\x3d"{{ ngName }}" ng-change\x3d"ngChange()" class\x3d"{{ selectClass }}" ng-model\x3d"$parent.ngModel" theme\x3d"bootstrap" search-enabled\x3d"searchEnabled" ng-disabled\x3d"ngDisabled" ng-required\x3d"myRequired"\x3e'+' \x3cui-select-match placeholder\x3d"{{ placeholder }}"\x3e{{ $select.selected.ClDesc }}\x3c/ui-select-match\x3e       '+' \x3cui-select-choices repeat\x3d"item.ClInf as item in data | propsFilter: {ClInf: $select.search, ClDesc: $select.search}"\x3e                          '+'      \x3cdiv ng-bind-html\x3d"item.ClDesc | highlight: $select.search"\x3e\x3c/div\x3e'+"  \x3c/ui-select-choices\x3e"+"\x3c/ui-select\x3e",link:link};function link(scope,element,attrs){scope.data=undefined;scope.placeholder=scope.placeholder||"\u8bf7\u9009\u62e9...";if(scope.configOption)AjaxService.GetTableConfig(scope.configOption.Table,scope.configOption.Column).then(function(data){scope.data=data;if(data.length>0&&scope.autoFirst)scope.ngModel=scope.ngModel||data[0].ClInf})}}]).directive("commonDataSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",ngDisabled:"\x3d",searchEnabled:"\x3d",placeholder:"@",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'\x3cui-select name\x3d"{{ ngName }}" ng-change\x3d"ngChange()" class\x3d"{{ selectClass }}" ng-model\x3d"$parent.ngModel" theme\x3d"bootstrap" search-enabled\x3d"searchEnabled" ng-disabled\x3d"ngDisabled" ng-required\x3d"myRequired"\x3e'+' \x3cui-select-match placeholder\x3d"{{ placeholder }}"\x3e{{ $select.selected.ComName }}\x3c/ui-select-match\x3e       '+' \x3cui-select-choices repeat\x3d"item.ComName as item in data | propsFilter: {ComName: $select.search}"\x3e                          '+'      \x3cdiv ng-bind-html\x3d"item.ComName | highlight: $select.search"\x3e\x3c/div\x3e'+"  \x3c/ui-select-choices\x3e"+"\x3c/ui-select\x3e",link:link};function link(scope,element,attrs){scope.data=undefined;scope.placeholder=scope.placeholder||"\u8bf7\u9009\u62e9...";AjaxService.GetPlans("CommonData").then(function(data){scope.data=data;if(data.length>0)scope.ngModel=scope.ngModel||data[0].ComName})}}]).directive("entitySelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"\x3d",obType:"\x3d",ngDisabled:"\x3d",connectName:"\x3d",clear:"\x3d",selectClass:"@",myRequired:"@",ngName:"@",ngChange:"\x26"},template:'\x3cdiv class\x3d"py-xl-0 pt-xl-0" ng-class\x3d"{ \'input-group\' : clear }"\x3e'+'    \x3cui-select ng-model\x3d"$parent.ngModel" ng-change\x3d"ngChange()" class\x3d"{{ selectClass }}" theme\x3d"bootstrap" ng-disabled\x3d"ngDisabled" name\x3d"{{ ngName }}" ng-required\x3d"myRequired"\x3e'+'         \x3cui-select-match placeholder\x3d"\u8bf7\u9009\u62e9..."\x3e{{ $select.selected.EntityName }}\x3c/ui-select-match\x3e'+'          \x3cui-select-choices class\x3d"pl-1" repeat\x3d"item.EntityName as item in data | filter: $select.search track by item.EntityName" refresh\x3d"refresh($select.search)" refresh-delay\x3d"0"\x3e'+'             \x3cdiv ng-bind-html\x3d"item.EntityName | highlight: $select.search"\x3e\x3c/div\x3e'+"         \x3c/ui-select-choices\x3e"+"     \x3c/ui-select\x3e"+'    \x3cspan class\x3d"input-group-btn" ng-if\x3d"clear"\x3e'+'        \x3cbutton ng-click\x3d"$parent.ngModel\x3d undefined" class\x3d"btn btn-default" ng-disabled\x3d"ngDisabled"\x3e'+'            \x3cspan class\x3d"glyphicon glyphicon-trash text-danger"\x3e\x3c/span\x3e'+"         \x3c/button\x3e"+"     \x3c/span\x3e"+" \x3c/div\x3e",link:link};function link(scope,element,attrs){scope.$watch("connectName",getData);scope.data=undefined;function getData(newValue,oldValue){scope.data=undefined;scope.ngModel=newValue!=oldValue?undefined:scope.ngModel;var en={};en.name="ConnectName";en.value=scope.connectName||"";AjaxService.GetPlans("SelectEntity",en).then(function(data){scope.data=data;scope.ListData=angular.copy(scope.data)})}scope.refresh=function refresh(ser){if(ser){scope.data=[];scope.ListData=scope.ListData||[];for(var j=0,len=scope.ListData.length;j<len;j++)if(scope.ListData[j].EntityName.toUpperCase().indexOf(ser.toUpperCase())!=-1)scope.data.push(scope.ListData[j]);if(scope.data.length==0){scope.data=undefined;scope.ngModel=undefined;var en={},list=[];en.name="ConnectName";en.value=scope.connectName;en.type="\x3d";list.push(en);var en2={};en2.name="EntityName";en2.value="%"+ser+"%";en2.type="like";list.push(en2);AjaxService.GetPlans("SelectEntity",list).then(function(data){scope.data=data})}}else scope.data=scope.ListData}}}]).directive("importSheetJs",["$q","AjaxService","toastr","FileLoad","ToJsonWorker","Version",function($q,AjaxService,toastr,FileLoad,ToJsonWorker,Version){return{restrict:"A",scope:{isImport:"@",fileType:"@",opts:"\x3d",ngComplete:"\x26"},templateUrl:"js/directives/ImportSheetJs.html?v\x3d"+Version,link:function($scope,elm){$scope.opts=$scope.opts||{};$scope.fileType=$scope.fileType||"*";$scope.isImport=$scope.isImport||"false";$scope.ngModel=$scope.ngModel||"";var op=$scope.opts;op.sheetNum=op.sheetNum||1;$scope.Open=function(e){e.target.parentNode.parentElement.firstElementChild.click()};var fileInput=elm[0].firstElementChild.firstElementChild.firstElementChild;var circle=elm[0].lastElementChild;fileInput.onchange=function(changeEvent){if(!changeEvent.target.files||changeEvent.target.files.length==0)return;var file=changeEvent.target.files[0];var exec=/[.]/.exec(file.name)?/[^.]+$/.exec(file.name.toLowerCase()):"";if($scope.fileType!="*"&&$scope.fileType.indexOf(exec[0])==-1){toastr.error("\u6587\u4ef6\u683c\u5f0f\u4e0d\u5bf9\uff0c\u8bf7\u4e0a\u4f20 "+$scope.fileType+" \u6587\u4ef6!");return false}$scope.$apply(function(){$scope.ngModel=file.name;$scope.Progress=0});var option={};option.file=file;option.onProcent=function process(pro){var d=$q.defer();setTimeout(function(){$scope.$apply(function(){$scope.Progress=pro})},1E3);d.resolve("");return d.promise};option.onComplete=function(data){ToJsonWorker.onmessage=function(evt){$scope.$apply(function(){$scope.opts.data=evt.data;$scope.ngComplete();$scope.Progress=0})};ToJsonWorker.postMessage({data:data,op:op})};FileLoad.Load(option)};function ToJson(data){var wb=XLSX.read(data,{type:"binary"});var Data=[];for(var i=0;i<op.sheetNum;i++){var wsname=wb.SheetNames[i];var ws=wb.Sheets[wsname];var aoa=XLSX.utils.sheet_to_json(ws,op.header);Data.push(aoa)}$scope.opts.data=Data;$scope.ngComplete()}}}}]).directive("fileUploadMuti",["$window","Version","toastr","FileService",function($window,Version,toastr,FileService){return{restrict:"A",scope:{ngDisabled:"@",fileType:"@",ngName:"@",ngRequired:"@",placeholder:"@",ableDrag:"@",fileData:"\x3d",ngComplete:"\x26"},templateUrl:"js/directives/UploadFileMuti.html?v\x3d"+Version,controller:["$scope",function($scope){var option={};$scope.List=[];$scope.fileData=$scope.fileData||[];option.onComplete=function(data){if($scope.ngComplete)$scope.ngComplete()};option.onCompleteItem=function(item){$scope.fileData.push(angular.copy(item.data));item.remove()};if($scope.fileType&&$scope.fileType!="*")option.filter=$scope.fileType;$scope.uploader=FileService.upLoad(option)}],link:function($scope,elm){$scope.fileType=$scope.fileType||"*";$scope.opts=$scope.opts||{};$scope.ngDisabled=$scope.ngDisabled||"false";var op=$scope.opts;$scope.Open=function(e){e.target.parentNode.parentElement.parentElement.lastElementChild.click()};$scope.Delete=function(index){$scope.fileData.splice(index,1)};$scope.DownLoad=function(url){$window.open(url)}}}}]).directive("fileUpload",["$window","Version","toastr","FileService",function($window,Version,toastr,FileService){return{restrict:"A",scope:{ngDisabled:"@",fileType:"@",ngName:"@",ngRequired:"@",placeholder:"@",fileData:"\x3d",ngComplete:"\x26"},templateUrl:"js/directives/UploadFile.html?v\x3d"+Version,controller:["$scope",function($scope){var option={};$scope.fileData=$scope.fileData||{};option.onComplete=function(data){if($scope.ngComplete)$scope.ngComplete();$scope.isUploaded=true};option.onCompleteItem=function(item){$scope.fileData=item.data;$scope.item=item};if($scope.fileType&&$scope.fileType!="*")option.filter=$scope.fileType;$scope.uploader=FileService.upLoad(option);$scope.uploader.autoUpload=true}],link:function($scope,elm){$scope.fileType=$scope.fileType||"*";$scope.ngDisabled=$scope.ngDisabled||"false";$scope.Open=function(e){$scope.uploader.clearQueue();e.target.parentNode.parentElement.parentElement.lastElementChild.click()};$scope.DownLoad=function(url){$window.open(url)};var fileInput=elm[0].firstElementChild.firstElementChild.lastElementChild;fileInput.onchange=function(changeEvent){if(!changeEvent.target.files||changeEvent.target.files.length==0)return;var file=changeEvent.target.files[0].name;var exec=/[.]/.exec(file.name)?/[^.]+$/.exec(file.name.toLowerCase()):"";if($scope.fileType!="*"&&$scope.fileType.indexOf(exec[0])==-1)return;$scope.fileData.OriginalName=file.name;$scope.isUploaded=false}}}}]).directive("ngStep",function(){return{restrict:"A",scope:{opts:"\x3d"},template:"\x3cdiv\x3e\x3c/div\x3e",link:link};function link($scope,element,attr){$scope.opts=$scope.opts||{};$scope.opts.now=$scope.opts.now||1;$scope.opts.reject=$scope.opts.reject||$scope.opts.now;$scope.opts.size=$scope.opts.size||"small";$scope.opts.color=$scope.opts.color||"green";$scope.opts.steps=$scope.opts.steps||[{title:"\u53d1\u8d77",content:"\u6b65\u9aa41"},{title:"\u7ed3\u675f",content:"\u6b65\u9aa42"}];$(element).loadStep($scope.opts);$(element).setStep($scope.opts.now,$scope.opts.reject)}});"use strict";angular.module("FileLoad",[]).factory("FileLoad",["$rootScope","$q","AjaxService","$ocLazyLoad",function($rootScope,$q,AjaxService,$ocLazyLoad){var h={Load:function(option){var me=h;me.precetMethod=option.onProcent;me.type=option.type||"binary";me.encode=option.encode||"utf-8";me.onComplete=option.onComplete;me.onSliceData=option.onProgress;me.onProcent=option.onProcent;me.step=1024*1024;me.loaded=0;me.times=0;me.result="";var d=$q.defer();var file=me.file=option.file;var reader=me.reader=new FileReader;me.total=file.size;reader.onloadstart=me.onLoadStart;reader.onprogress=me.onProgress;reader.onabort=me.onAbort;reader.onerror=me.onerror;reader.onload=me.onLoad;reader.onloadend=me.onLoadEnd;me.readBlob(file,me.loaded);me.result=me.result+reader.result},onLoadStart:function(){var me=h},onProgress:function(e){var me=h;if(me.onProcent)me.onProcent(me.loaded/me.total*100)},onAbort:function(){var me=h},onError:function(){var me=h},onLoad:function(e){var me=h;if(me.onSliceData)me.onSliceData(e.target.result);if(me.loaded<me.total){me.result=me.result+e.target.result;me.readBlob(me.loaded);me.loaded+=me.step}else{me.loaded=me.total;me.result=me.result+e.target.result;if(me.onComplete)me.onComplete(me.result)}},onLoadEnd:function(){var me=h},readBlob:function(start){var me=h;var blob,file=me.file;me.times+=1;if(file.slice)blob=file.slice(start,start+me.step);else blob=file;switch(me.type){case "binary":me.reader.readAsBinaryString(blob);break;case "buffer":me.reader.readAsArrayBuffer(blob);break;case "url":me.reader.readAsDataURL(blob);break;case "text":me.reader.readAsText(blob,me.encode);break}},abortHandler:function(){var me=h;if(me.reader)me.reader.abort()}};return h}]);(function(){angular.module("FileService",["angularFileUpload"]);angular.module("FileService").factory("FileService",FileService);FileService.$inject=["FileUploader","FileServiceUrl","toastr"];function FileService(FileUploader,FileServiceUrl,toastr){var file={upLoad:function(option){option=option||{};var me=file;me.List=[];option.maxFile=option.maxFile||10;uploader=new FileUploader({url:FileServiceUrl+"FileService.asmx/FileUpload"});uploader.filters.push({name:"maxFilter",fn:function(item,options){return this.queue.length<option.maxFile}});if(option.filter)uploader.filters.push({name:"FileFilter",fn:function(item,options){var exec=/[.]/.exec(item.name)?/[^.]+$/.exec(item.name.toLowerCase()):"";if(option.filter.indexOf(exec[0])==-1){toastr.error("\u6587\u4ef6\u683c\u5f0f\u4e0d\u5bf9\uff0c\u8bf7\u4e0a\u4f20 "+option.filter+" \u6587\u4ef6!");return false}return option.filter.indexOf(exec[0])!=-1}});uploader.filters.push({name:"asyncFilter",fn:function(item,options,deferred){setTimeout(deferred.resolve,1E3)}});uploader.onWhenAddingFileFailed=function(item,filter,options){};uploader.onErrorItem=function(fileItem,response,status,headers){console.log(response);toastr.error("\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25")};uploader.onSuccessItem=function(fileItem,response,status,headers){if(response[0]){me.List.push(response[0]);fileItem.data=response[0];if(option.onCompleteItem)option.onCompleteItem(fileItem)}};uploader.onCompleteItem=function(fileItem,response,status,headers){};uploader.onCompleteAll=function(){if(option.onComplete)option.onComplete(me.List)};return uploader}};return file}})();"use strict";angular.module("ui.load",[]).service("uiLoad",["$document","$q","$timeout",function($document,$q,$timeout){var loaded=[];var promise=false;var deferred=$q.defer();this.load=function(srcs){srcs=angular.isArray(srcs)?srcs:srcs.split(/\s+/);var self=this;if(!promise)promise=deferred.promise;angular.forEach(srcs,function(src){promise=promise.then(function(){return src.indexOf(".css")>=0?self.loadCSS(src):self.loadScript(src)})});deferred.resolve();return promise};this.loadScript=function(src){if(loaded[src])return loaded[src].promise;var deferred=$q.defer();var script=$document[0].createElement("script");script.src=src;script.onload=function(e){$timeout(function(){deferred.resolve(e)})};script.onerror=function(e){$timeout(function(){deferred.reject(e)})};$document[0].body.appendChild(script);loaded[src]=deferred;return deferred.promise};this.loadCSS=function(href){if(loaded[href])return loaded[href].promise;var deferred=$q.defer();var style=$document[0].createElement("link");style.rel="stylesheet";style.type="text/css";style.href=href;style.onload=function(e){$timeout(function(){deferred.resolve(e)})};style.onerror=function(e){$timeout(function(){deferred.reject(e)})};$document[0].head.appendChild(style);loaded[href]=deferred;return deferred.promise}}]);"use strict";angular.module("app",["appData","ngAnimate","toastr","cgBusy","ngMessages","ngCookies","ngResource","ngSanitize","ngTouch","ngStorage","ui.router","FileService","toggle-switch","ui.bootstrap","ui.load","ui.jq","ui.validate","oc.lazyLoad","pascalprecht.translate","AjaxServiceModule","ui.router.requirePolyfill","MyDirective","FileLoad"]);var app=angular.module("app").config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function($controllerProvider,$compileProvider,$filterProvider,$provide){app.controller=$controllerProvider.register;app.directive=$compileProvider.directive;app.filter=$filterProvider.register;app.factory=$provide.factory;app.service=$provide.service;app.constant=$provide.constant;app.value=$provide.value}]).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"l10n/",suffix:".js"});$translateProvider.preferredLanguage("zh");$translateProvider.preferredLanguage("cn");$translateProvider.useLocalStorage()}]);angular.module("app").constant("JQ_CONFIG",{easyPieChart:["Scripts/jquery/charts/easypiechart/jquery.easy-pie-chart.js"],sparkline:["Scripts/jquery/charts/sparkline/jquery.sparkline.min.js"],plot:["Scripts/jquery/charts/flot/jquery.flot.min.js","Scripts/jquery/charts/flot/jquery.flot.resize.js","Scripts/jquery/charts/flot/jquery.flot.tooltip.min.js","Scripts/jquery/charts/flot/jquery.flot.spline.js","Scripts/jquery/charts/flot/jquery.flot.orderBars.js","Scripts/jquery/charts/flot/jquery.flot.pie.min.js"],slimScroll:["Scripts/jquery/slimscroll/jquery.slimscroll.min.js"],sortable:["Scripts/jquery/sortable/jquery.sortable.js"],nestable:["Scripts/jquery/nestable/jquery.nestable.js","Scripts/jquery/nestable/nestable.css"],filestyle:["Scripts/jquery/file/bootstrap-filestyle.min.js"],slider:["Scripts/jquery/slider/bootstrap-slider.js","Scripts/jquery/slider/slider.css"],chosen:["Scripts/jquery/chosen/chosen.jquery.min.js","Scripts/jquery/chosen/chosen.css"],TouchSpin:["Scripts/jquery/spinner/jquery.bootstrap-touchspin.min.js","Scripts/jquery/spinner/jquery.bootstrap-touchspin.css"],wysiwyg:["Scripts/jquery/wysiwyg/bootstrap-wysiwyg.js","Scripts/jquery/wysiwyg/jquery.hotkeys.js"],dataTable:["Scripts/jquery/datatables/jquery.dataTables.min.js","Scripts/jquery/datatables/dataTables.bootstrap.js","Scripts/jquery/datatables/dataTables.bootstrap.css"],vectorMap:["Scripts/jquery/jvectormap/jquery-jvectormap.min.js","Scripts/jquery/jvectormap/jquery-jvectormap-world-mill-en.js","Scripts/jquery/jvectormap/jquery-jvectormap-us-aea-en.js","Scripts/jquery/jvectormap/jquery-jvectormap.css"],footable:["Scripts/jquery/footable/footable.all.min.js","Scripts/jquery/footable/footable.core.css"]}).config(["$ocLazyLoadProvider",function($ocLazyLoadProvider){$ocLazyLoadProvider.config({debug:false,events:true,modules:[{name:"uiGrid",files:["Scripts/ui-grid.min.js","Content/ui-grid.min.css"]},{name:"ngGrid",files:["Scripts/modules/ng-grid/ng-grid.min.js","Scripts/modules/ng-grid/ng-grid.min.css","Scripts/modules/ng-grid/theme.css"]},{name:"fileLoad",files:["Scripts/SheetJs/xlsx.full.min.js"]},{name:"datetimepicker",files:["Scripts/jquery/DateTimePicker/jquery.datetimepicker.min.css","Scripts/jquery/DateTimePicker/jquery.datetimepicker.full.min.js"]},{name:"ui.select",files:["Scripts/select.min.js","Content/select.min.css"]},{name:"angularFileUpload",files:["Scripts/modules/angular-file-upload/angular-file-upload.min.js"]},{name:"ui.calendar",files:["Scripts/modules/angular-ui-calendar/calendar.js"]},{name:"ngImgCrop",files:["Scripts/modules/ngImgCrop/ng-img-crop.js","Scripts/modules/ngImgCrop/ng-img-crop.css"]},{name:"angularBootstrapNavTree",files:["Scripts/modules/angular-bootstrap-nav-tree/abn_tree_directive.js","Scripts/modules/angular-bootstrap-nav-tree/abn_tree.css"]},{name:"toaster",files:["Scripts/modules/angularjs-toaster/toaster.js","Scripts/modules/angularjs-toaster/toaster.css"]},{name:"textAngular",files:["Scripts/modules/textAngular/textAngular-sanitize.min.js","Scripts/modules/textAngular/textAngular.min.js"]},{name:"vr.directives.slider",files:["Scripts/modules/angular-slider/angular-slider.min.js","Scripts/modules/angular-slider/angular-slider.css"]},{name:"com.2fdevs.videogular",files:["Scripts/modules/videogular/videogular.min.js"]},{name:"com.2fdevs.videogular.plugins.controls",files:["Scripts/modules/videogular/plugins/controls.min.js"]},{name:"com.2fdevs.videogular.plugins.buffering",files:["Scripts/modules/videogular/plugins/buffering.min.js"]},{name:"com.2fdevs.videogular.plugins.overlayplay",files:["Scripts/modules/videogular/plugins/overlay-play.min.js"]},{name:"com.2fdevs.videogular.plugins.poster",files:["Scripts/modules/videogular/plugins/poster.min.js"]},{name:"com.2fdevs.videogular.plugins.imaads",files:["Scripts/modules/videogular/plugins/ima-ads.min.js"]}]})}]);"use strict";angular.module("app").run(Run);Run.$inject=["$rootScope","$state","$stateParams","$cookieStore","$window","$q","AjaxService","router","appUrl","Version"];function Run($rootScope,$state,$stateParams,$cookieStore,$window,$q,AjaxService,router,appUrl,Version){$rootScope.$state=$state;$rootScope.$stateParams=$stateParams;$cookieStore.put("active-function","Main");$rootScope.$on("$stateChangeStart",onStateChangeStart);function onStateChangeStart(e,toState,toParams,fromState,fromParams){if(!$cookieStore.get("user-token"))$window.location.href=appUrl+"Acess.html#!/login"}AjaxService.LoginAction("GetFunRoute").then(function(data){angular.forEach(data,function(item){var route={};route.Name=item.RouteName;route.Url=item.RouteUrl;route.Controller=item.Controller;route.ControllerAs=item.ControllerAs;route.TempleteUrl=item.FunHtml+"?v\x3d"+Version;route.FunNo=item.FunNo;if(item.FunLoad){var loadJs=[];angular.forEach(item.FunLoad,function(l){loadJs.push(l.LoadName+"?v\x3d"+Version)});route.LazyLoad=loadJs}router.setDataRouters(route)})});AjaxService.LoginAction("GetLoginEmp").then(function(data){$rootScope.User=data});AjaxService.GetPlans("Dialog").then(function(data){$rootScope.DialogData=data})}angular.module("app").config(Config);Config.$inject=["$stateProvider","$urlRouterProvider","Version"];function Config($stateProvider,$urlRouterProvider,Version){$urlRouterProvider.otherwise("/app/dashboard-v1");$stateProvider.state("app",{"abstract":true,url:"/app",controllerAs:"vm",controller:"AppCtrl",templateUrl:"Basic/app.html"+"?v\x3d"+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["ui.select","ngGrid"])}]}}).state("apps",{"abstract":true,controllerAs:"vm",controller:"AppCtrl",url:"/apps",templateUrl:"Basic/layout.html"+"?v\x3d"+Version}).state("app.dashboard-v1",{url:"/dashboard-v1",templateUrl:"Basic/app_dashboard_v1.html"+"?v\x3d"+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["js/controllers/chart.js"])}]}}).state("app.ui",{url:"/ui",template:'\x3cdiv ui-view class\x3d"fade-in-up"\x3e\x3c/div\x3e'})}"use strict";angular.module("app").factory("Dialog",["$rootScope","$ocLazyLoad","$uibModal","$q","AjaxService","Version",function($rootScope,$ocLazyLoad,$uibModal,$q,AjaxService,Version){var obj={open:open};return obj;function open(name,resolve,option){var d=$q.defer();var dialog=$.grep($rootScope.DialogData,function(e){return e.name==name})[0],config=angular.extend({templateUrl:dialog.templateUrl+"?v\x3d"+Version,controller:dialog.controller,backdrop:dialog.backdrop||"static",size:dialog.size},option||{});if(dialog.controllerAs)config.controllerAs=dialog.controllerAs;if(dialog.keyboard&&config.keyboard==undefined)config.keyboard=dialog.keyboard=="true";config.resolve=resolve;if(dialog.LoadFiles){var loadList=[];for(var i=0,len=dialog.LoadFiles.length;i<len;i++)loadList.push(dialog.LoadFiles[i].LoadName+"?v\x3d"+Version);$ocLazyLoad.load(loadList).then(function(){d.resolve($uibModal.open(config).result)})}return d.promise}}]);"use strict";angular.module("app").controller("AppCtrl",["$scope","$localStorage","$window","AjaxService","$state","$rootScope","$cookieStore","appUrl","Dialog",function($scope,$localStorage,$window,AjaxService,$state,$rootScope,$cookieStore,appUrl,Dialog){var isIE=!!navigator.userAgent.match(/MSIE/i);isIE&&angular.element($window.document.body).addClass("ie");isSmartDevice($window)&&angular.element($window.document.body).addClass("smart");var vm=this;vm.FunctionList=[];vm.Go=Go;vm.ChangPsw=ChangPsw;vm.LogOff=LogOff;vm.app={name:"\u7ba1\u7406\u5e73\u53f0",version:"1.3.3",color:{primary:"#7266ba",info:"#23b7e5",success:"#27c24c",warning:"#fad733",danger:"#f05050",light:"#e8eff0",dark:"#3a3f51",black:"#1c2b36"},settings:{themeID:1,navbarHeaderColor:"bg-black",navbarCollapseColor:"bg-white-only",asideColor:"bg-black",headerFixed:true,asideFixed:false,asideFolded:false,asideDock:false,container:false}};GetList();if(angular.isDefined($localStorage.settings))vm.app.settings=$localStorage.settings;else $localStorage.settings=vm.app.settings;$scope.$watch("vm.app.settings",function(){if(vm.app.settings.asideDock&&vm.app.settings.asideFixed)vm.app.settings.headerFixed=true;$localStorage.settings=vm.app.settings},true);function GetList(){vm.promise=AjaxService.LoginAction("GetUserRoot").then(function(data){vm.FunTree=data;vm.FunctionList=[];for(var i=0,len=data.length;i<len;i++)for(var j=0,len2=data[i].FunList.length;j<len2;j++){var en={};en.RouteName=data[i].FunList[j].RouteName;en.FunName=data[i].FunName+"/"+data[i].FunList[j].FunName;vm.FunctionList.push(en)}});vm.ConfigData=[]}function Go(routeName){$state.go(routeName)}function ChangPsw(){var resolve={ItemData:function(){return{}}};Dialog.open("ChangePswDialog",resolve).then(function(data){getListRole()})["catch"](function(reason){})}function LogOff(){AjaxService.LoginAction("LoginOff").then(function(data){$cookieStore.remove("user-token");$window.location.href=appUrl+"Acess.html#!/login"})}function isSmartDevice($window){var ua=$window["navigator"]["userAgent"]||$window["navigator"]["vendor"]||$window["opera"];return/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/.test(ua)}}]);"use strict";angular.module("app").provider("router",function($stateProvider){var urlCollection;this.$get=function($http,$state){return{setUpRoutes:function(){$http.get(urlCollection).success(function(collection){for(var routeName in collection)if(!$state.get(routeName))$stateProvider.state(routeName,collection[routeName])})},setDataRouters:function(route){if(!$state.get(route.Name)){var item={};item.url=route.Url;item.templateUrl=route.TempleteUrl;if(route.Controller)item.controller=route.Controller;if(route.ControllerAs)item.controllerAs=route.ControllerAs;if(route.LazyLoad&&route.LazyLoad.length>0){var len=route.LazyLoad.length;item.resolve={deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(route.LazyLoad)}]}}item.resolve=angular.extend(item.resolve||{},{Fun:["$cookieStore",function($cookieStore){$cookieStore.put("active-function",route.FunNo);return route.FunNo}]});$stateProvider.state(route.Name,item)}}}};this.setCollectionUrl=function(url){urlCollection=url}});angular.module("app").directive("setNgAnimate",["$animate",function($animate){return{link:function($scope,$element,$attrs){$scope.$watch(function(){return $scope.$eval($attrs.setNgAnimate,$scope)},function(valnew,valold){$animate.enabled(!!valnew,$element)})}}}]);angular.module("app").directive("uiButterbar",["$rootScope","$anchorScroll",function($rootScope,$anchorScroll){return{restrict:"AC",template:'\x3cspan class\x3d"bar"\x3e\x3c/span\x3e',link:function(scope,el,attrs){el.addClass("butterbar hide");scope.$on("$stateChangeStart",function(event){$anchorScroll();el.removeClass("hide").addClass("active")});scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState){event.targetScope.$watch("$viewContentLoaded",function(){el.addClass("hide").removeClass("active")})})}}}]);angular.module("app").directive("uiFocus",function($timeout,$parse){return{link:function(scope,element,attr){var model=$parse(attr.uiFocus);scope.$watch(model,function(value){if(value===true)$timeout(function(){element[0].focus()})});element.bind("blur",function(){if(model&&model.assign)scope.$apply(model.assign(scope,false))})}}});angular.module("app").directive("uiFullscreen",["uiLoad","$document","$window",function(uiLoad,$document,$window){return{restrict:"AC",template:'\x3ci class\x3d"fa fa-expand fa-fw text"\x3e\x3c/i\x3e\x3ci class\x3d"fa fa-compress fa-fw text-active"\x3e\x3c/i\x3e',link:function(scope,el,attr){el.addClass("hide");uiLoad.load("Scripts/libs/screenfull.min.js").then(function(){if(screenfull.enabled&&!navigator.userAgent.match(/Trident.*rv:11\./))el.removeClass("hide");el.on("click",function(){var target;attr.target&&(target=$(attr.target)[0]);screenfull.toggle(target)});$document.on(screenfull.raw.fullscreenchange,function(){if(screenfull.isFullscreen)el.addClass("active");else el.removeClass("active")})})}}}]);"use strict";angular.module("ui.jq",["ui.load"]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","JQ_CONFIG","uiLoad","$timeout",function uiJqInjectingFunction(uiJqConfig,JQ_CONFIG,uiLoad,$timeout){return{restrict:"A",compile:function uiJqCompilingFunction(tElm,tAttrs){if(!angular.isFunction(tElm[tAttrs.uiJq])&&!JQ_CONFIG[tAttrs.uiJq])throw new Error('ui-jq: The "'+tAttrs.uiJq+'" function does not exist');var options=uiJqConfig&&uiJqConfig[tAttrs.uiJq];return function uiJqLinkingFunction(scope,elm,attrs){function getOptions(){var linkOptions=[];if(attrs.uiOptions){linkOptions=scope.$eval("["+attrs.uiOptions+"]");if(angular.isObject(options)&&angular.isObject(linkOptions[0]))linkOptions[0]=angular.extend({},options,linkOptions[0])}else if(options)linkOptions=[options];return linkOptions}if(attrs.ngModel&&elm.is("select,input,textarea"))elm.bind("change",function(){elm.trigger("input")});function callPlugin(){$timeout(function(){elm[attrs.uiJq].apply(elm,getOptions())},0,false)}function refresh(){if(attrs.uiRefresh)scope.$watch(attrs.uiRefresh,function(){callPlugin()})}if(JQ_CONFIG[attrs.uiJq])uiLoad.load(JQ_CONFIG[attrs.uiJq]).then(function(){callPlugin();refresh()})["catch"](function(){});else{callPlugin();refresh()}}}}}]);angular.module("app").directive("uiModule",["MODULE_CONFIG","uiLoad","$compile",function(MODULE_CONFIG,uiLoad,$compile){return{restrict:"A",compile:function(el,attrs){var contents=el.contents().clone();return function(scope,el,attrs){el.contents().remove();uiLoad.load(MODULE_CONFIG[attrs.uiModule]).then(function(){$compile(contents)(scope,function(clonedElement,scope){el.append(clonedElement)})})}}}}]);angular.module("app").directive("uiNav",["$timeout",function($timeout){return{restrict:"AC",link:function(scope,el,attr){var _window=$(window),_mb=768,wrap=$(".app-aside"),next,backdrop=".dropdown-backdrop";el.on("click","a",function(e){next&&next.trigger("mouseleave.nav");var _this=$(this);_this.parent().siblings(".active").toggleClass("active");_this.next().is("ul")&&_this.parent().toggleClass("active")&&e.preventDefault();_this.next().is("ul")||_window.width()<_mb&&$(".app-aside").removeClass("show off-screen")});el.on("mouseenter","a",function(e){next&&next.trigger("mouseleave.nav");$("\x3e .nav",wrap).remove();if(!$(".app-aside-fixed.app-aside-folded").length||_window.width()<_mb||$(".app-aside-dock").length)return;var _this=$(e.target),top,w_h=$(window).height(),offset=50,min=150;!_this.is("a")&&(_this=_this.closest("a"));if(_this.next().is("ul"))next=_this.next();else return;_this.parent().addClass("active");top=_this.parent().position().top+offset;next.css("top",top);if(top+next.height()>w_h)next.css("bottom",0);if(top+min>w_h)next.css("bottom",w_h-top-offset).css("top","auto");next.appendTo(wrap);next.on("mouseleave.nav",function(e){$(backdrop).remove();next.appendTo(_this.parent());next.off("mouseleave.nav").css("top","auto").css("bottom","auto");_this.parent().removeClass("active")});$(".smart").length&&$('\x3cdiv class\x3d"dropdown-backdrop"/\x3e').insertAfter(".app-aside").on("click",function(next){next&&next.trigger("mouseleave.nav")})});wrap.on("mouseleave",function(e){next&&next.trigger("mouseleave.nav");$("\x3e .nav",wrap).remove()})}}}]);angular.module("app").directive("uiScroll",["$location","$anchorScroll",function($location,$anchorScroll){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){$location.hash(attr.uiScroll);$anchorScroll()})}}}]);angular.module("app").directive("uiShift",["$timeout",function($timeout){return{restrict:"A",link:function(scope,el,attr){var _el=$(el),_window=$(window),prev=_el.prev(),parent,width=_window.width();!prev.length&&(parent=_el.parent());function sm(){$timeout(function(){var method=attr.uiShift;var target=attr.target;_el.hasClass("in")||_el[method](target).addClass("in")})}function md(){parent&&parent["prepend"](el);!parent&&_el["insertAfter"](prev);_el.removeClass("in")}width<768&&sm()||md();_window.resize(function(){if(width!==_window.width())$timeout(function(){_window.width()<768&&sm()||md();width=_window.width()})})}}}]);angular.module("app").directive("uiToggleClass",["$timeout","$document",function($timeout,$document){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){e.preventDefault();var classes=attr.uiToggleClass.split(","),targets=attr.target&&attr.target.split(",")||Array(el),key=0;angular.forEach(classes,function(_class){var target=targets[targets.length&&key];_class.indexOf("*")!==-1&&magic(_class,target);$(target).toggleClass(_class);key++});$(el).toggleClass("active");function magic(_class,target){var patt=new RegExp("\\s"+_class.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");var cn=" "+$(target)[0].className+" ";while(patt.test(cn))cn=cn.replace(patt," ");$(target)[0].className=$.trim(cn)}})}}}]).directive("uiRemoveClass",["$timeout","$document",function($timeout,$document){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){e.preventDefault();var classes=attr.uiRemoveClass.split(","),targets=attr.target&&attr.target.split(",")||Array(el),key=0;angular.forEach(classes,function(_class){var target=targets[targets.length&&key];_class.indexOf("*")!==-1&&magic(_class,target);$(target).removeClass(_class);key++});$(el).removeClass("active");function magic(_class,target){var patt=new RegExp("\\s"+_class.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");var cn=" "+$(target)[0].className+" ";while(patt.test(cn))cn=cn.replace(patt," ");$(target)[0].className=$.trim(cn)}})}}}]);"use strict";angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(scope,elm,attrs,ctrl){var validateFn,validators={},validateExpr=scope.$eval(attrs.uiValidate);if(!validateExpr)return;if(angular.isString(validateExpr))validateExpr={validator:validateExpr};angular.forEach(validateExpr,function(exprssn,key){validateFn=function(valueToValidate){var expression=scope.$eval(exprssn,{"$value":valueToValidate});if(angular.isObject(expression)&&angular.isFunction(expression.then)){expression.then(function(){ctrl.$setValidity(key,true)},function(){ctrl.$setValidity(key,false)});return valueToValidate}else if(expression){ctrl.$setValidity(key,true);return valueToValidate}else{ctrl.$setValidity(key,false);return valueToValidate}};validators[key]=validateFn;ctrl.$formatters.push(validateFn);ctrl.$parsers.push(validateFn)});function apply_watch(watch){if(angular.isString(watch)){scope.$watch(watch,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})});return}if(angular.isArray(watch)){angular.forEach(watch,function(expression){scope.$watch(expression,function(){angular.forEach(validators,function(validatorFn){validatorFn(ctrl.$modelValue)})})});return}if(angular.isObject(watch))angular.forEach(watch,function(expression,validatorKey){if(angular.isString(expression))scope.$watch(expression,function(){validators[validatorKey](ctrl.$modelValue)});if(angular.isArray(expression))angular.forEach(expression,function(intExpression){scope.$watch(intExpression,function(){validators[validatorKey](ctrl.$modelValue)})})})}if(attrs.uiValidateWatch)apply_watch(scope.$eval(attrs.uiValidateWatch))}}});"use strict";angular.module("app").filter("propsFilter",function(){return function(items,props){var out=[];if(angular.isArray(items)){var keys=Object.keys(props);items.forEach(function(item){var itemMatches=false;for(var i=0;i<keys.length;i++){var prop=keys[i];var text=props[prop].toLowerCase();if(item[prop].toString().toLowerCase().indexOf(text)!==-1){itemMatches=true;break}}if(itemMatches)out.push(item)})}else out=items;return out}});"use strict";angular.module("app").filter("fromNow",function(){return function(date){return moment(date).fromNow()}});
//# sourceMappingURL=mxqh.min.js.map
