!function(){function httpWatch($cookieStore){return{request:function(config){return $cookieStore.get("user-token")&&(config.headers["x-session-token"]=$cookieStore.get("user-token")),config.headers["x-function"]=$cookieStore.get("active-function")||"",config}}}angular.module("AjaxServiceModule",["appData","ngAnimate","toastr","ngCookies"]),angular.module("AjaxServiceModule").config(function($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",$httpProvider.defaults.transformRequest=function(data){return void 0===data?data:$.param(data)},$httpProvider.interceptors.push(httpWatch)}),angular.module("AjaxServiceModule").factory("httpWatch",httpWatch)}();
!function(){function AjaxService($rootScope,$http,$q,serviceUrl,appUrl,toastr,MyPop,$cookieStore,$window,FileUrl,SocketServiceUrl,$state){var generic="Common.asmx/Do",tableConfigList=new Array;return{DoBefore:function(method,en){var d=$q.defer(),url=serviceUrl+"Common.asmx/DoBefore",json={method:method,Json:JSON.stringify(en)};return httpFun(d,url,json)},Custom:function(method,en){return Ajax($q.defer(),serviceUrl+generic,en=en||{},method,void 0,"Custom")},BasicCustom:function(method,en){return Ajax($q.defer(),serviceUrl+generic,en=en||{},method)},GetPlan:function(name,json,limitCol){return plan(name,json,"GetPlan",void 0,void 0,limitCol)},GetPlans:GetPlans,GetPlansTop:function(name,json,top,limitCol){return plan(name,json,"GetPlansTop",void 0,void 0,limitCol,top)},GetPlansPage:function(name,json,index,size,limitCol){var s=index<=1?1:(index-1)*size+1;return plan(name,json,"GetPlansPage",s,s+size,limitCol)},GetPlanExcel:function(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return Ajax(d,url,en,"GetPlanExcel")},GetPlanOwnExcel:function(name,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,"--",json=json||[]);return Ajax(d,url,en,"GetPlanOwnExcel")},SavePlan:function(name,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,void 0,json);return Ajax(d,url,en,"SavePlan")},ReflashPlan:function(name){var d=$q.defer(),url=serviceUrl+generic,en={};return en.planName=name,Ajax(d,url,en,"ReflashPlan")},DeletePlan:function(name,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,void 0,json);return Ajax(d,url,en,"DeletePlan")},PlanInsert:function(name,json){return planAjax(name,JSON.stringify(json),"Insert")},PlanUpdate:function(name,json){return planAjax(name,JSON.stringify(json),"Update")},PlanDelete:function(name,json){return planAjax(name,JSON.stringify(json),"Delete")},PlanBak:function(action,json){var d=$q.defer(),url=serviceUrl+generic,en={};return en.action=action,en.strJson=json,Ajax(d,url,en,"PlanBak")},ExecPlan:function(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return Ajax(d,url,en,"ExecPlan")},ExecPlanPage:function(name,shortName,json,index,size){var d=$q.defer(),url=serviceUrl+generic,s=index<=1?1:(index-1)*size+1,en=getEn(name,shortName,json);return en.start=s,en.end=s+size,Ajax(d,url,en,"ExecPlanPage")},ExecPlanToExcel:function(name,shortName,json,sheetTable){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return en.sheetTable=JSON.stringify(convertArray(sheetTable)),Ajax(d,url,en,"ExecPlanToExcel")},GetEntity:function(name,json){return entity(name,json,"GetEntity")},GetEntities:function(name,json){return entity(name,json,"GetEntities")},GetJson:function(data){var d=$q.defer(),url=appUrl+"Data/"+data+"?v="+(new Date).toString();return Ajax(d,url,void 0,void 0,"GET")},Action:function(name,json,action){var d=$q.defer(),url=serviceUrl+generic,en={};return en.strTbView=name,en.strJson=JSON.stringify(json),Ajax(d,url,en,action)},HandleFile:function(type){return AjaxHandle("GetFileList",type)},AjaxHandle:AjaxHandle,AddDialog:function(data){return AjaxHandle("AddDialog",data)},GetTableConfig:function(tbName,clName){var d=$q.defer();if(tableConfigList[tbName+"-"+clName]&&0<tableConfigList[tbName+"-"+clName].length)d.resolve(tableConfigList[tbName+"-"+clName]),console.log("have");else{var list=[{name:"TbName",value:tbName},{name:"ClName",value:clName}];GetPlans("TableConfig",list).then(function(data){tableConfigList[tbName+"-"+clName]=data,d.resolve(data)})}return d.promise},AddUser:function(json){var d=$q.defer(),url=serviceUrl+generic,en={};return en.strJson=JSON.stringify(json),Ajax(d,url,en,"AddUser",void 0,"Authorization")},LoginAction:function(method,en){return Ajax($q.defer(),serviceUrl+generic,en=en||{},method,void 0,"Authorization")},FileImport:function(name,shortName,json,file,inData,sheetTable){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return en.filaName=file,en.bt=inData,en.sheetTable=JSON.stringify(convertArray(sheetTable)),Ajax(d,url,en,"FileImport")},ExecPlanUpload:function(name,shortName,json,fileJson,dir){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return en.fileJson=JSON.stringify(fileJson),en.dir=dir,Ajax(d,url,en,"ExecPlanUpload")},ExecPlanMail:function(name,shortName,json){var d=$q.defer(),url=serviceUrl+generic,en=getEn(name,shortName,json);return Ajax(d,url,en,"ExecPlanMail")},GetDefaultPrinter:function(hostIp){return SocketSend("GetDefaultPrinter",void 0,void 0,void 0,void 0,hostIp)},GetLocalPrinters:function(hostIp){var d=$q.defer();return SocketSend("GetLocalPrinters",void 0,void 0,void 0,void 0,hostIp).then(function(data){d.resolve(JSON.parse(data))},function(mes){d.reject(mes)}),d.promise},Print:function(templateId,TS,postData,printerName,hostIp){var d=$q.defer();return SocketSend("Print",templateId,TS,postData,printerName,hostIp).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},PrintMulti:function(templateId,TS,postData,printerName,hostIp){var d=$q.defer();return SocketSend("PrintMulti",templateId,TS,postData,printerName,hostIp).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},GetComPortList:function(hostIp){var d=$q.defer();return SocketSend("GetComPortList",void 0,void 0,void 0,void 0,hostIp).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},GetComWeigth:function(com,Do){var d=$q.defer();return SocketSend("GetComWeigth",void 0,void 0,void 0,com,void 0,Do).then(function(data){d.resolve(data)},function(mes){d.reject(mes)}),d.promise},PlayVoice:function(name){$("#autoVoice").attr("src",FileUrl+"/Voice/"+name)},GetServerTime:function(Do){return CallServerSocket("Time",void 0,Do)},GetServerSocket:function(json,Do){return CallServerSocket("Request",JSON.stringify(json),Do)}};function GetPlans(name,json,limitCol){return plan(name,json,"GetPlans",void 0,void 0,limitCol)}function AjaxHandle(method,data){var q=$q.defer();return httpFun(q,appUrl+"Data/Handler/FileData.ashx",{method:method,data:data}),q.promise}function entity(name,json,funName){var d=$q.defer(),url=serviceUrl+generic,en={};return en.strName=name,en.strJson=JSON.stringify(convertArray(json))||"[]",Ajax(d,url,en,funName)}function plan(name,json,funName,start,end,limitCol,top){return planAjax(name,JSON.stringify(convertArray(json))||"[]",funName,start,end,limitCol,top)}function planAjax(name,json,funName,start,end,limitCol,top){var d=$q.defer(),url=serviceUrl+generic,en={};return en.planName=name,en.strJson=json,en.start=start,en.end=end,en.top=top,en.limitUserCol=limitCol,Ajax(d,url,en,funName)}function Ajax(q,url,parameter,Method,type,service){return httpFun(q,url,{method:Method,Json:JSON.stringify(parameter),service:service||""},type)}function httpFun(q,url,postData,type){return $http({method:type||"POST",url:url+"?v="+("GetPlansPage"==postData.method?"sdfa":Math.random()),dataType:"json",data:postData}).then(function(data){q.resolve(data.data),"GetPlansPage"==postData.method&&console.log(data)},function(data){if(q.reject(),401==data.status)$cookieStore.remove("user-token"),$window.location.href!=appUrl+"Access.html#!/login"&&($window.location.href=appUrl+"Access.html#!/login");else{console.log(data);var m=data.data?data.data.split("。")[0].replace(/System.Exception:/,""):"错误";toastr.error(m,"服务错误")}}),q.promise}function getEn(name,shortName,json){var en={};return en.planName=name,en.shortName=shortName,en.strJson=JSON.stringify(json),en}function convertArray(en){if(!en)return en;if("function"==typeof Array.isArray?Array.isArray(en):"[object Array]"===Object.prototype.toString.call(en))return en;var enNew=[];return enNew.push(en),enNew}function SocketSend(method,Id,TS,postData,printerName,hostIp,Do){var g=$q.defer();try{var socket=new WebSocket("ws://"+(hostIp||"127.0.0.1")+":2018");socket.onerror=function(evt){if(console.log(evt.currentTarget),3==evt.currentTarget.readyState){var en={};$window.location.href="MxqhPrinter:"+serviceUrl,en.text="打印服务正在启动，重新发送数据？",MyPop.Confirm(en,function(){SocketSend(method,Id,TS,postData,printerName,hostIp)})}},socket.onopen=function(){var en={};en.Method=method,en.TemplateId=Id,en.TS=TS,en.Data=JSON.stringify(postData),en.ServiceUrl=serviceUrl,en.PrinterName=printerName,console.log(en),socket.send(JSON.stringify(en))},socket.onclose=function(e){},socket.onmessage=function(evt){var reData=JSON.parse(evt.data);"Success"==reData.MesType?g.resolve(reData.Data):"Error"==reData.MesType?(toastr.error(reData.Data,"服务错误"),g.reject(reData.Data)):"Update"==reData.MesType&&(toastr.warning("服务器已有新版本的打印插件，请下载更新"),$window.location.href=reData.Data),Do&&Do(reData)}}catch(e){console.log("服务错误"),toastr.error(e,"服务错误")}return g.promise}function CallServerSocket(MsgType,json,Do){var g=$q.defer();try{var en={Header:"MXQHServer"};en.MsgType=MsgType,en.LoginKey=$cookieStore.get("user-token"),en.RouteName=$state.current.name,en.Data=json;!function CallSocket(g,en,socket,Do,interval){socket=new WebSocket(SocketServiceUrl);socket.onerror=function(evt){};socket.onopen=function(){socket.send(JSON.stringify(en)),null!=interval&&clearInterval(interval),interval=setInterval(function(){3==socket.readyState&&CallSocket(g,en,socket,Do,interval)},15e3)};socket.onclose=function(e){};socket.onmessage=function(evt){var data=JSON.parse(evt.data);"Heartbeat"==data.MsgType?data.RouteName==$state.current.name||"Time"==en.MsgType?socket.send(evt.data):console.log(evt.data):("Success"==data.Response?g.resolve(data.Data):"Error"==data.Response&&(toastr.error(data.Data,"服务错误"),g.reject(data.Data)),Do&&Do(data.Data))}}(g,en,void 0,Do,void 0)}catch(e){toastr.error(e,"服务错误")}return g.promise}}angular.module("AjaxServiceModule").factory("AjaxService",AjaxService),AjaxService.$inject=["$rootScope","$http","$q","serviceUrl","appUrl","toastr","MyPop","$cookieStore","$window","FileUrl","SocketServiceUrl","$state"]}();
!function(){function FileService(FileUploader,FileServiceUrl,toastr){var file={upLoad:function(option){option=option||{};var me=file;return me.List=[],option.maxFile=option.maxFile||10,uploader=new FileUploader({url:FileServiceUrl+"FileService.asmx/FileUpload"}),uploader.filters.push({name:"maxFilter",fn:function(item,options){return this.queue.length<option.maxFile}}),option.filter&&uploader.filters.push({name:"FileFilter",fn:function(item,options){var exec=/[.]/.exec(item.name)?/[^.]+$/.exec(item.name.toLowerCase()):"";return-1==option.filter.indexOf(exec[0])?(toastr.error("文件格式不对，请上传 "+option.filter+" 文件!"),!1):-1!=option.filter.indexOf(exec[0])}}),uploader.filters.push({name:"asyncFilter",fn:function(item,options,deferred){setTimeout(deferred.resolve,1e3)}}),uploader.onWhenAddingFileFailed=function(item,filter,options){},uploader.onErrorItem=function(fileItem,response,status,headers){console.log(response),toastr.error("文件上传失败")},uploader.onSuccessItem=function(fileItem,response,status,headers){response[0]&&(me.List.push(response[0]),fileItem.data=response[0],option.onCompleteItem&&option.onCompleteItem(fileItem))},uploader.onCompleteItem=function(fileItem,response,status,headers){},uploader.onCompleteAll=function(){option.onComplete&&option.onComplete(me.List)},uploader}};return file}angular.module("FileService",["angularFileUpload"]),angular.module("FileService").factory("FileService",FileService),FileService.$inject=["FileUploader","FileServiceUrl","toastr"]}();
"use strict";angular.module("MyDirective",[]),angular.module("MyDirective").directive("ngConfirm",function(){return{restrict:"A",priority:1,terminal:!0,link:function(scope,element,attr){scope.$watchCollection(attr.ngConfirm,function(options){var en=options||{};en.title=en.title||"确认",en.text=en.text||"是否删除此笔资料",en.type=en.type||"warning",en.showCancelButton=void 0===en.showCancelButton||!0,en.confirmButtonText=en.confirmButtonText||"确定！",en.cancelButtonText=en.cancelButtonText||"取消！";var clickAction=attr.ngClick;element.bind("click",function(){swal(en,function(isConfirm){isConfirm&&scope.$eval(clickAction)})})})}}}).directive("dateTimePicker",["$ocLazyLoad",function($ocLazyLoad){return{require:"?ngModel",restrict:"A",scope:{ngModel:"=",option:"="},link:function(scope,element,attr,ngModel){scope.option=scope.option||{formatTime:"H:i",formatDate:"Y.m.d",timepickerScrollbar:!1},$ocLazyLoad.load("datetimepicker").then(function(){$.datetimepicker.setLocale("zh"),element.datetimepicker(scope.option)})}}}]).directive("datePicker",["$ocLazyLoad",function($ocLazyLoad){return{require:"?ngModel",restrict:"A",scope:{ngModel:"=",option:"="},link:function(scope,element,attr,ngModel){scope.option=scope.option||{format:"Y/m/d",formatDate:"Y/m/d",timepicker:!1},$ocLazyLoad.load("datetimepicker").then(function(){$.datetimepicker.setLocale("zh"),element.datetimepicker(scope.option)})}}}]).directive("basicSelect",["AjaxService","appUrl",function(AjaxService,appUrl){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",searchEnabled:"=",clear:"=",selectClass:"@",autoFirst:"@",placeholder:"@",ngRequired:"@",ngName:"@",ngChange:"&"},templateUrl:function(element,attrs){return appUrl+"CustomFun/UISelect/"+attrs.basicSelect+".html?date="+(new Date).toString()},link:function(scope,element,attrs){if(scope.data=void 0,scope.autoFirst=scope.autoFirst||"false",attrs.basicSelect){var en=[{name:"SelectName",value:attrs.basicSelect}];AjaxService.GetPlan("SysUISelect",en).then(function(data){if(data.SelectName==attrs.basicSelect){var list=[],enName=data,ListData=[],holder=data.Placeholder||"请选择...";if(scope.placeholder=scope.placeholder||holder,data.SerList&&0<data.SerList.length)for(var i=0,len=data.SerList.length;i<len;i++){var en={};en.name=data.SerList[i].ColName,en.value=data.SerList[i].SerValue,en.type=data.SerList[i].SerExp,en.action=data.SerList[i].SerAss,en.level=data.SerList[i].SerLevel,list.push(en)}angular.copy(list);AjaxService.GetPlansTop(data.EntityName,list,100).then(function(data2){scope.data=data2,ListData=angular.copy(scope.data),0<data2.length&&"true"==scope.autoFirst.toLowerCase()&&!scope.ngModel&&(scope.ngModel=null==data.ReturnColumn||""==data.ReturnColumn?data2[0]:data2[0][data.ReturnColumn])}),scope.refresh=function(ser){if(ser){console.log(ser),scope.data=[];for(var j=0,len=(ListData=ListData||[]).length;j<len;j++)(-1!==ListData[j][enName.ShowColumn].toUpperCase().indexOf(ser.toUpperCase())||ListData[j][enName.ShowSmallColumn]&&-1!==ListData[j][enName.ShowSmallColumn].toUpperCase().indexOf(ser.toUpperCase()))&&scope.data.push(ListData[j]);if(0===scope.data.length){scope.data=[];var list2=angular.copy(list);list2.push({name:enName.ShowColumn,value:"%"+ser+"%"}),AjaxService.GetPlansTop(enName.EntityName,list2,100).then(function(data){scope.data=data,0<scope.data.length&&(ListData=angular.copy(scope.data))})}}else scope.data&&0==scope.data.length&&(scope.data=angular.copy(ListData))}}})}scope.ValueChange=function(){setTimeout(function(){scope.ngChange()},1)}}}}]).directive("serData",["AjaxService","appUrl",function(AjaxService,appUrl){return{restrict:"A",scope:{list:"=",serData:"@"},link:function(scope,element,attrs){if(console.log(scope.serData),scope.serData){var en=[{name:"SelectName",value:scope.serData}];AjaxService.GetPlan("SysUISelect",en).then(function(data){if(data.SelectName){var list=[];if(data.SerList&&0<data.SerList.length)for(var i=0,len=data.SerList.length;i<len;i++){var en={};en.name=data.SerList[i].ColName,en.value=data.SerList[i].SerValue,en.type=data.SerList[i].SerExp,en.action=data.SerList[i].SerAss,en.level=data.SerList[i].SerLevel,list.push(en)}AjaxService.GetPlans(data.EntityName,list).then(function(data2){scope.list=data2})}})}}}}]).directive("functionSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",funType:"@",ngDisabled:"=",clear:"=",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'<div class="py-xl-0 pt-xl-0" ng-class="{ \'input-group\' : clear }"><ui-select ng-model="$parent.ngModel" ng-change="ngChange()" theme="bootstrap" class="{{ selectClass }}" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">  <ui-select-match placeholder="请选择...">{{ $select.selected.FunName }}</ui-select-match> <ui-select-choices repeat="item.FunNo as item in data | filter: $select.search track by item.FunNo">      <div ng-bind-html="item.FunName | highlight: $select.search"></div>  </ui-select-choices></ui-select>    <span class="input-group-btn" ng-if="clear">        <button ng-click="$parent.ngModel= undefined" class="btn btn-default" ng-disabled="ngDisabled">            <span class="glyphicon glyphicon-trash text-danger"></span>         </button>     </span> </div>',link:function(scope,element,attrs){scope.data=void 0;var en={name:"FunType"};en.value=1==scope.funType?1:2,AjaxService.GetEntities("Function",en).then(function(data){scope.data=data})}}}]).directive("funFileSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",fileType:"=",ngDisabled:"=",clear:"=",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'<div class="py-xl-0 pt-xl-0" ng-class="{ \'input-group\' : clear }">    <ui-select ng-model="$parent.ngModel" theme="bootstrap" ng-change="ngChange()" class="{{ selectClass }}" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="请选择...">{{ $select.selected }}</ui-select-match>          <ui-select-choices repeat="item in data | filter: $select.search track by item">             <div ng-bind-html="item | highlight: $select.search"></div>         </ui-select-choices>     </ui-select>    <span class="input-group-btn" ng-if="clear">        <button ng-click="$parent.ngModel= undefined" class="btn btn-default" ng-disabled="ngDisabled">            <span class="glyphicon glyphicon-trash text-danger"></span>         </button>     </span> </div>',link:function(scope,element,attrs){scope.data=void 0,AjaxService.HandleFile(scope.fileType).then(function(data){scope.data=data})}}}]).directive("objectSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",obConnect:"=",obType:"=",ngDisabled:"=",placeholder:"@",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'    <ui-select ng-model="$parent.ngModel" theme="bootstrap" ng-change="ngChange()" class="{{ selectClass }}" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="{{ placeholder }}">{{ $select.selected.Name }}</ui-select-match>          <ui-select-choices class="pl-1" repeat="item in data | filter: $select.search track by item.Name" refresh="refresh($select.search)" refresh-delay="0">             <small><span ng-bind-html="item.DbSchema | highlight: $select.search"></span>.<span ng-bind-html="item.Name | highlight: $select.search"</span></small>         </ui-select-choices>     </ui-select>',link:function(scope,element,attrs){scope.data=void 0,scope.$watch("obConnect",function(newValue,oldValue){if(scope.obConnect){scope.data=void 0;var en={};en.strCon=scope.obConnect,en.strType=scope.obType,en.strSearch="",AjaxService.BasicCustom("GetDbObject",en).then(function(data){scope.data=data.data,scope.ListData=angular.copy(scope.data)})}}),scope.placeholder=scope.placeholder||"请选择...",scope.refresh=function(ser){if(ser){scope.data=[],scope.ListData=scope.ListData||[];for(var j=0,len=scope.ListData.length;j<len;j++)-1===scope.ListData[j].DbSchema.toUpperCase().indexOf(ser.toUpperCase())&&-1===scope.ListData[j].Name.toUpperCase().indexOf(ser.toUpperCase())||scope.data.push(scope.ListData[j]);if(0===scope.data.length){scope.data=void 0;var en={};en.strCon=scope.obConnect,en.strType=scope.obType,en.strSearch=ser,AjaxService.BasicCustom("GetDbObject",en).then(function(data){scope.data=data.data})}}else scope.data=scope.ListData}}}}]).directive("connectSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",clear:"=",selectClass:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'<div class="py-xl-0 pt-xl-0" ng-class="{ \'input-group\' : clear }">    <ui-select ng-model="$parent.ngModel" theme="bootstrap" ng-change="ngChange()"  class="{{ selectClass }}" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="请选择...">{{ $select.selected }}</ui-select-match>          <ui-select-choices class="pl-1" repeat="item in data | filter: $select.search track by item" refresh-delay="0">             <div ng-bind-html="item | highlight: $select.search"></div>         </ui-select-choices>     </ui-select>    <span class="input-group-btn" ng-if="clear">        <button ng-click="$parent.ngModel= undefined" class="btn btn-default" ng-disabled="ngDisabled">            <span class="glyphicon glyphicon-trash text-danger"></span>         </button>     </span> </div>',link:function(scope,element,attrs){AjaxService.BasicCustom("GetConnectList").then(function(data){scope.data=data,scope.ListData=angular.copy(scope.data),scope.ngModel=scope.ngModel||data[0]})}}}]).directive("configSelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",searchEnabled:"=",configOption:"=",placeholder:"@",selectClass:"@",ngRequired:"@",ngName:"@",autoFirst:"@",ngChange:"&"},template:'<ui-select name="{{ ngName }}" ng-change="ngChange()" class="{{ selectClass }}" ng-model="$parent.ngModel" theme="bootstrap" search-enabled="searchEnabled" ng-disabled="ngDisabled" ng-required="ngRequired"> <ui-select-match placeholder="{{ placeholder }}">{{ $select.selected.ClDesc }}</ui-select-match>        <ui-select-choices repeat="item.ClInf as item in data | propsFilter: {ClInf: $select.search, ClDesc: $select.search}">                                <div ng-bind-html="item.ClDesc | highlight: $select.search"></div>  </ui-select-choices></ui-select>',link:function(scope,element,attrs){scope.data=void 0,scope.autoFirst=scope.autoFirst||"false",scope.placeholder=scope.placeholder||"请选择...",scope.configOption&&AjaxService.GetTableConfig(scope.configOption.Table,scope.configOption.Column).then(function(data){0<(scope.data=data).length&&"true"==scope.autoFirst.toLowerCase()&&(scope.ngModel=scope.ngModel||data[0].ClInf)})}}}]).directive("configSelectMulti",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",searchEnabled:"=",configOption:"=",placeholder:"@",selectClass:"@",ngRequired:"@",ngName:"@",autoFirst:"@",ngChange:"&"},template:'<ui-select name="{{ ngName }}" ng-change="ngChange()" class="{{ selectClass }}" ng-model="$parent.ngModel" theme="bootstrap" search-enabled="searchEnabled" ng-disabled="ngDisabled" ng-required="ngRequired" multiple> <ui-select-match placeholder="{{ placeholder }}">{{ $item.ClDesc }}</ui-select-match>        <ui-select-choices repeat="item.ClInf as item in data | propsFilter: {ClInf: $select.search, ClDesc: $select.search}">                                <div ng-bind-html="item.ClDesc | highlight: $select.search"></div>  </ui-select-choices></ui-select>',link:function(scope,element,attrs){scope.data=void 0,scope.autoFirst=scope.autoFirst||"false",scope.placeholder=scope.placeholder||"请选择...",scope.configOption&&AjaxService.GetTableConfig(scope.configOption.Table,scope.configOption.Column).then(function(data){0<(scope.data=data).length&&"true"==scope.autoFirst.toLowerCase()&&(scope.ngModel&&0!=scope.ngModel.length||(scope.ngModel=[],scope.ngModel.push(data[0].ClInf)))})}}}]).directive("entitySelect",["AjaxService",function(AjaxService){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",obType:"=",ngDisabled:"=",connectName:"=",clear:"=",selectClass:"@",autoFirst:"@",ngRequired:"@",ngName:"@",ngChange:"&"},template:'<div class="py-xl-0 pt-xl-0" ng-class="{ \'input-group\' : clear }">    <ui-select ng-model="$parent.ngModel" ng-change="ValueChange()" class="{{ selectClass }}" theme="bootstrap" ng-disabled="ngDisabled" name="{{ ngName }}" ng-required="ngRequired">         <ui-select-match placeholder="请选择...">{{ $select.selected.EntityName }}</ui-select-match>          <ui-select-choices class="pl-1" repeat="item.EntityName as item in data | filter: $select.search track by item.EntityName" refresh="refresh($select.search)" refresh-delay="0">             <div ng-bind-html="item.EntityName | highlight: $select.search"></div>         </ui-select-choices>     </ui-select>    <span class="input-group-btn" ng-if="clear">        <button ng-click="$parent.ngModel= undefined" class="btn btn-default" ng-disabled="ngDisabled">            <span class="glyphicon glyphicon-trash text-danger"></span>         </button>     </span> </div>',link:function(scope,element,attrs){scope.$watch("connectName",function(newValue,oldValue){scope.data=void 0,scope.ngModel=newValue!=oldValue?void 0:scope.ngModel;var en={name:"ConnectName"};en.value=scope.connectName||"",AjaxService.GetPlans("SelectEntity",en).then(function(data){0<(scope.data=data).length&&"true"==scope.autoFirst.toLowerCase()&&(scope.ngModel=scope.ngModel||data[0].EntityName),scope.ListData=angular.copy(scope.data)})}),scope.autoFirst=scope.autoFirst||"false",scope.data=void 0,scope.ValueChange=function(){setTimeout(function(){scope.ngChange()},100)},scope.refresh=function(ser){if(ser){scope.data=[],scope.ListData=scope.ListData||[];for(var j=0,len=scope.ListData.length;j<len;j++)-1!=scope.ListData[j].EntityName.toUpperCase().indexOf(ser.toUpperCase())&&scope.data.push(scope.ListData[j]);if(0==scope.data.length){scope.data=void 0,scope.ngModel=void 0;var en={},list=[];en.name="ConnectName",en.value=scope.connectName,en.type="=",list.push(en);var en2={name:"EntityName"};en2.value="%"+ser+"%",en2.type="like",list.push(en2),AjaxService.GetPlans("SelectEntity",list).then(function(data){scope.data=data})}}else scope.data=scope.ListData}}}}]).directive("importSheetJs",["$q","AjaxService","toastr","FileLoad","ToJsonWorker","Version",function($q,AjaxService,toastr,FileLoad,ToJsonWorker,Version){return{restrict:"A",scope:{isImport:"@",fileType:"@",opts:"=",ngComplete:"&"},templateUrl:"js/directives/ImportSheetJs.html?v="+Version,link:function($scope,elm){$scope.opts=$scope.opts||{},$scope.fileType=$scope.fileType||"*",$scope.isImport=$scope.isImport||"false",$scope.ngModel=$scope.ngModel||"";var op=$scope.opts;op.sheetNum=op.sheetNum||1,$scope.Open=function(e){e.target.parentNode.parentElement.firstElementChild.click()};var fileInput=elm[0].firstElementChild.firstElementChild.firstElementChild;elm[0].lastElementChild;fileInput.onchange=function(changeEvent){if(changeEvent.target.files&&0!=changeEvent.target.files.length){var file=changeEvent.target.files[0],exec=/[.]/.exec(file.name)?/[^.]+$/.exec(file.name.toLowerCase()):"";if("*"!=$scope.fileType&&-1==$scope.fileType.indexOf(exec[0]))return toastr.error("文件格式不对，请上传 "+$scope.fileType+" 文件!"),!1;$scope.$apply(function(){$scope.ngModel=file.name,$scope.Progress=0});var option={};option.file=file,option.onProcent=function(pro){var d=$q.defer();return setTimeout(function(){$scope.$apply(function(){$scope.Progress=pro})},1e3),d.resolve(""),d.promise},option.onComplete=function(data){ToJsonWorker.onmessage=function(evt){$scope.$apply(function(){$scope.opts.data=evt.data,$scope.ngComplete(),$scope.Progress=0})},ToJsonWorker.postMessage({data:data,op:op})},FileLoad.Load(option)}}}}}]).directive("fileUploadMulti",["$window","Version","toastr","FileService",function($window,Version,toastr,FileService){return{restrict:"A",scope:{ngDisabled:"@",fileType:"@",ngName:"@",ngRequired:"@",placeholder:"@",ableDrag:"@",fileData:"=",ngComplete:"&"},templateUrl:"js/directives/UploadFileMuti.html?v="+Version,controller:["$scope",function($scope){var option={};$scope.List=[],$scope.fileData=$scope.fileData||[],option.onComplete=function(data){$scope.ngComplete&&$scope.ngComplete()},option.onCompleteItem=function(item){$scope.fileData.push(angular.copy(item.data)),item.remove()},$scope.fileType&&"*"!=$scope.fileType&&(option.filter=$scope.fileType),$scope.uploader=FileService.upLoad(option)}],link:function($scope,elm){$scope.fileType=$scope.fileType||"*",$scope.opts=$scope.opts||{},$scope.ngDisabled=$scope.ngDisabled||"false";$scope.opts;$scope.Open=function(e){e.target.parentNode.parentElement.parentElement.lastElementChild.click()},$scope.Delete=function(index){$scope.fileData.splice(index,1)},$scope.DownLoad=function(url){$window.open(url)}}}}]).directive("fileUpload",["$window","Version","toastr","FileService",function($window,Version,toastr,FileService){return{restrict:"A",scope:{ngDisabled:"@",fileType:"@",ngName:"@",ngRequired:"@",placeholder:"@",fileData:"=",ngComplete:"&"},templateUrl:"js/directives/UploadFile.html?v="+Version,controller:["$scope",function($scope){var option={};$scope.fileData=$scope.fileData||{},option.onComplete=function(data){$scope.ngComplete&&$scope.ngComplete(),$scope.isUploaded=!0},option.onCompleteItem=function(item){$scope.fileData=item.data,$scope.item=item},$scope.fileType&&"*"!=$scope.fileType&&(option.filter=$scope.fileType),$scope.uploader=FileService.upLoad(option),$scope.uploader.autoUpload=!0}],link:function($scope,elm){$scope.fileType=$scope.fileType||"*",$scope.ngDisabled=$scope.ngDisabled||"false",$scope.Open=function(e){$scope.uploader.clearQueue(),e.target.parentNode.parentElement.parentElement.lastElementChild.click()},$scope.DownLoad=function(url){$window.open(url)},elm[0].firstElementChild.firstElementChild.lastElementChild.onchange=function(changeEvent){if(changeEvent.target.files&&0!=changeEvent.target.files.length){var file=changeEvent.target.files[0].name,exec=/[.]/.exec(file.name)?/[^.]+$/.exec(file.name.toLowerCase()):"";"*"!=$scope.fileType&&-1==$scope.fileType.indexOf(exec[0])||($scope.fileData.OriginalName=file.name,$scope.isUploaded=!1)}}}}}]).directive("ngStep",function(){return{restrict:"A",scope:{opts:"="},template:"<div></div>",link:function($scope,element,attr){$scope.opts=$scope.opts||{},$scope.opts.now=$scope.opts.now||1,$scope.opts.reject=$scope.opts.reject||$scope.opts.now,$scope.opts.size=$scope.opts.size||"small",$scope.opts.color=$scope.opts.color||"green",$scope.opts.steps=$scope.opts.steps||[{title:"发起",content:"步骤1"},{title:"结束",content:"步骤2"}],$(element).loadStep($scope.opts),$(element).setStep($scope.opts.now,$scope.opts.reject)}}}).directive("replaceEnter",function(){return{restrict:"A",priority:1,terminal:!0,link:function($scope,element,attr){element.html(""),$scope.$watchCollection(attr.replaceEnter,function(data){var en=data?data.replace(/\n/g,"<br/>"):"";element.html(en)})}}});
"use strict";angular.module("access",["appData","ngAnimate","toastr","ngMessages","ngResource","ngSanitize","ngStorage","ui.router","ui.bootstrap","oc.lazyLoad","AjaxServiceModule","MyDirective","FileService"]);var app=angular.module("access");function Run($rootScope,$state,$stateParams,AjaxService,appUrl,Version){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams}function Config($stateProvider,$urlRouterProvider,Version){$urlRouterProvider.otherwise("/login"),$stateProvider.state("login",{url:"/login",controllerAs:"Log",controller:"LoginCtrl",templateUrl:"Access/login.html?v="+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["Content/Css/Main.css","Access/login.js?v="+Version])}]}}).state("forgotPsd",{url:"/forgotpsd",controllerAs:"psd",controller:"ForgotPasswordCtrl",templateUrl:"Access/ForgotPassword.html?v="+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["Content/Css/Main.css","Access/ForgotPassword.js?v="+Version])}]}}).state("changePsd",{url:"/changePsd",controllerAs:"psd",controller:"ChangePasswordCtrl",templateUrl:"Access/ChangePassword.html?v="+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["Access/ChangePassword.js?v="+Version])}]}}).state("signup",{url:"/signup",controllerAs:"sign",controller:"SignUpCtrl",templateUrl:"Access/SignUp.html?v="+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["Access/SignUp.js?v="+Version])}]}}).state("sdkdownload",{url:"/sdkdownload",controllerAs:"sdk",controller:"SdkDownloadLinkCtrl",templateUrl:"UIFun/SDKFun/SdkDownloadLink.html?v="+Version,resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["UIFun/SDKFun/SdkDownloadLink.js?v="+Version])}]}})}app.config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function($controllerProvider,$compileProvider,$filterProvider,$provide){app.controller=$controllerProvider.register,app.directive=$compileProvider.directive,app.filter=$filterProvider.register,app.factory=$provide.factory,app.service=$provide.service,app.constant=$provide.constant,app.value=$provide.value}]),app.run(Run),Run.$inject=["$rootScope","$state","$stateParams","AjaxService","appUrl","Version"],app.config(Config),Config.$inject=["$stateProvider","$urlRouterProvider","Version"];