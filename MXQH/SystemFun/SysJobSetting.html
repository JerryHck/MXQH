<div class="bg-light lter b-b wrapper-md" cg-busy="job.promise">
    <div class="col-md-3 text-center">
        <span class="m-n font-thin h3">任务作业管理</span>
        <button class="btn btn-sm btn-success pull-left" ng-click="job.Insert()" ui-toggle-class="active" target=".insert-job"><i class="glyphicon glyphicon-plus"></i>任务</button>
    </div>
    <div class="form-inline">
        <div class="form-group">
            <input type="text" class="form-control" ng-model="job.Ser.JobName" placeholder="任务名称">
        </div>
        <button class="btn btn-sm btn-info" ng-click="job.Search()"><i class="glyphicon glyphicon-search"></i>查询</button>

    </div>
</div>
<div class="wrapper-md">
    <div class="col-md-4" ng-repeat="item in job.List">
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                <a class="h3 pull-left thumb-sm text-success" ng-click="job.JobEdit(item)" title="编辑产品"><i class="glyphicon glyphicon-edit"></i></a>
                <a class="h3">{{ item.JobName }}</a>
                <a class="h3 pull-right thumb-sm text-danger" ng-confirm="{text:'确定要删除任务吗'}" ng-click="job.JobDelete(item)" title="删除计划"><i class="glyphicon glyphicon-remove"></i></a>
            </div>
            <div class="panel-body">
                <article class="media">
                    <small class="media-left pull-left">上次执行:</small>
                    <div class="media-body">
                        <small class="block">{{ item.LastRunTime | date:'yyyy-MM-dd HH:mm:ss' }}</small>
                        <span></span>
                    </div>
                </article>
                <article class="media">
                    <small class="media-left pull-left">下次执行:</small>
                    <div class="media-body">
                        <small class="block">{{ item.NextTime | date:'yyyy-MM-dd HH:mm:ss' }}</small>
                        <span></span>
                    </div>
                </article>
                <article class="media scroll-y" style="height:40px">
                    <small class="media-left pull-left">任务说明:</small>
                    <div class="media-body">
                        <small class="block" replace-enter="item.JobDesc"></small>
                    </div>
                </article>
            </div>
        </div>
    </div>
    <div class="col-md-12 text-center" ng-if="job.page.total>job.page.size">
        <div uib-pagination total-items="job.page.total" ng-model="job.page.index" items-per-page="job.page.size" max-size="10" first-text="第一页" previous-text="上一页"
             ng-change="job.PageChange()" next-text="下一页" last-text="最后页" boundary-links="true" boundary-link-numbers="true"></div>
    </div>
    <!--<pre>{{ job.Item | json }}</pre>-->
</div>
<div class="insert-job lg d-r bg-light dk">
    <div class="blur-close" ui-remove-class="active" target=".insert-job"></div>
    <div class="b-b wrapper-sm text-center">
        <a class="text-danger pull-left" ui-remove-class="active" target=".insert-job"><i class="glyphicon glyphicon-remove"></i></a>
        <span class="m-n font-thin h3" ng-if="!job.isEdit">计划新增</span>
        <span class="m-n font-thin h3" ng-if="job.isEdit"> 计划[ <strong>{{ job.Item.JobName }}</strong> ]编辑</span>
    </div>
    <div class="padder-md wrapper" ng-form="job.JobForm">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="form-horizontal">
                    <div class="form-group pull-in clearfix">
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">计划名</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.JobName.$invalid }">
                                <input type="text" class="form-control" name="JobName" placeholder="计划名" ng-model="job.Item.JobName" ng-disabled="job.isEdit || job.isCopy" ng-blur="job.isJobExists()" required>
                                <div ng-messages="job.JobForm.JobName.$error" class="help-block" role="alert">
                                    <div ng-message="unique">任务名已经存在</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">计划类型</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.JobType.$invalid }">
                                <div config-select ng-name="JobType" ng-model="job.Item.JobType" auto-first="true" placeholder="请选择执行类型" select-class="text-xs" config-option="job.JobType" my-required="true"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group pull-in clearfix">
                        <div class="col-sm-6" ng-if="job.Item.JobType=='O'">
                            <label class="control-label col-md-4">执行一次</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.NextRunTime.$invalid }">
                                <div class="input-group">
                                    <input type="text" date-time-picker class="form-control" name="NextRunTime" placeholder="选择执行时间" ng-model="job.Item.NextRunTime" option="job.NextOption" required>
                                    <span class="input-group-addon"><a class="text-success"><i class="glyphicon glyphicon-calendar"></i></a></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6" ng-if="job.Item.JobType=='R'">
                            <label class="control-label col-md-4">执行方式</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.RepeatType.$invalid }">
                                <div config-select ng-model="job.Item.RepeatType" auto-first="true" placeholder="请选择执行方式" select-class="text-xs" config-option="job.RepeatType" my-required="true"></div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">使用情况</label>
                            <div class="col-md-8">
                                <span toggle-switch class="switch-success pull-down" ng-model="job.Item.IsStart" on-label="启用" off-label="停止"></span>
                            </div>
                        </div>
                    </div>
                    <div class="line-dashed b-b"></div>
                </div>
                <div class="form-horizontal wrapper-xs" ng-if="job.Item.JobType=='R'">
                    <div class="form-group pull-in clearfix">
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">执行间隔</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.Interval.$invalid }">
                                <div class="input-group">
                                    <span class="input-group-addon">每</span>
                                    <input type="number" name="Interval" min="1" max="100" class="form-control" ng-model="job.Item.Interval" required />
                                    <span class="input-group-addon" ng-if="job.Item.RepeatType=='D'">天</span>
                                    <span class="input-group-addon" ng-if="job.Item.RepeatType=='W'">周</span>
                                    <span class="input-group-addon" ng-if="job.Item.RepeatType=='M'">月</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6" ng-if="job.Item.RepeatType =='W'">
                            <label class="control-label col-md-4">在</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.IntervalWeek.$invalid }">
                                <div config-select-multi ng-name="IntervalWeek" ng-model="job.Item.IntervalWeekList" auto-first="true" placeholder="请选择执行日" select-class="text-xs" config-option="job.Week" my-required="true"></div>
                            </div>
                        </div>
                        <div class="col-sm-6" ng-if="job.Item.RepeatType =='M'">
                            <label class="control-label col-md-4">在第</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.IntervalMonth.$invalid }">
                                <div class="input-group">
                                    <input type="number" name="IntervalMonth" min="1" max="31" class="form-control" ng-model="job.Item.IntervalMonth" required />
                                    <span class="input-group-addon">天</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="line-dashed b-b"></div>
                    <div class="form-group pull-in clearfix wrapper-xs">
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">一天频率</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.DayType.$invalid }">
                                <div config-select ng-name="DayType" ng-model="job.Item.DayType" auto-first="true" placeholder="请选择执行类型" select-class="text-xs" config-option="job.JobType" my-required="true"></div>
                            </div>
                        </div>
                        <div class="col-sm-6" ng-if="job.Item.DayType=='O'">
                            <label class="control-label col-md-4">执行时间</label>
                            <div class="col-md-8">
                                <input type="text" date-time-picker class="form-control" placeholder="执行时间" ng-model="job.Item.DayOneTime" option="job.TimeOption" />
                            </div>
                        </div>
                        <div class="col-sm-6" ng-if="job.Item.DayType=='R'">
                            <label class="control-label col-md-4">每</label>
                            <div class="col-md-8">
                                <div class="col-md-6" ng-class="{ 'has-error' : job.JobForm.DayInterval.$invalid }">
                                    <input type="number" name="DayInterval" min="1" max="100" class="form-control" ng-model="job.Item.DayInterval" required />
                                </div>
                                <div class="col-md-6" ng-class="{ 'has-error' : job.JobForm.DayFreUnit.$invalid }">
                                    <div config-select ng-name="DayFreUnit" ng-model="job.Item.DayFreUnit" auto-first="true" placeholder="请选择执行类型" select-class="text-xs" config-option="job.Unit" my-required="true"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group pull-in clearfix">
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">开始时间</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.StartDate.$invalid }">
                                <input type="text" name="StartDate" date-time-picker class="form-control" placeholder="开始时间" ng-model="job.Item.StartDate" option="job.StartOption" required />
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">结束时间</label>
                            <div class="col-md-8">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <label class="i-checks">
                                            <input type="checkbox" ng-model="job.Item.NoEndDate"><i></i>无
                                        </label>
                                    </span>
                                    <input type="text" ng-disabled="job.Item.NoEndDate" name="EndDate" date-time-picker class="form-control" placeholder="结束时间" ng-model="job.Item.EndDate" option="job.StartOption" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="line-dashed b-b"></div>
                </div>
                <div class="form-horizontal wrapper-xs">
                    <div class="form-group pull-in clearfix">
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">方法类型</label>
                            <div class="col-md-8" ng-class="{ 'has-error' : job.JobForm.MethodType.$invalid }">
                                <div config-select ng-name="MethodType" ng-model="job.Item.MethodType" auto-first="true" placeholder="请选择执行类型" select-class="text-xs" config-option="job.MethodType" my-required="true"></div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="control-label col-md-4">方法名</label>
                            <div class="col-md-8" ng-if="job.Item.MethodType=='Custom'" ng-class="{ 'has-error' : job.JobForm.JobExecMethod.$invalid }">
                                <input type="text" class="form-control" name="JobExecMethod" placeholder="方法名" ng-model="job.Item.JobExecMethod">
                            </div>
                            <div class="col-md-8" ng-if="job.Item.MethodType!='Custom'">
                                <div ng-class="{ 'has-error' : job.JobForm.JobExecMethod.$invalid }">
                                    <input type="text" uib-typeahead="en.EntityName as en.EntityName for en in job.EnList | filter:$viewValue | limitTo:8"
                                           class="form-control" name="JobExecMethod" placeholder="实体计划名" ng-model="job.Item.JobExecMethod" ng-change="job.Item.EnProShortName = undefined" ng-blur="job.EnChange()" required>
                                </div>
                                <div ng-class="{ 'has-error' : job.JobForm.EnProShortName.$invalid }">
                                    <input type="text" ng-if="job.Item.MethodType!='Custom'" class="form-control" name="EnProShortName" placeholder="存储过程简称"
                                           uib-typeahead="short.ShortName as short.ShortName for short in job.ShortList | filter:$viewValue | limitTo:8" ng-model="job.Item.EnProShortName" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-12">
                            <label class="control-label col-md-2">方法参数</label>
                            <div class="col-md-10">
                                <textarea class="form-control" rows="2" ng-model="job.Item.JobParameter" placeholder="输入方法参数, Json 格式 如:{A:1,B:2}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col text-center">
            <button class="btn btn-success" type="button" ng-disabled="job.JobForm.$invalid" ng-click="job.JobSave()">储存</button>
            <button class="btn btn-warning" type="button" ui-remove-class="active" target=".insert-job">取消</button>
        </div>


    </div>
</div>
